<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API接口测试页面</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="h3 mb-4">
                    <i class="fas fa-cogs me-2 text-primary"></i>API接口测试页面
                </h1>
                
                <!-- 测试结果显示区域 -->
                <div id="testResults" class="mb-4"></div>
                
                <!-- 课程管理API测试 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-book me-2"></i>课程管理API测试
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <button type="button" class="btn btn-primary w-100" onclick="testCourseFormData()">
                                    <i class="fas fa-download me-2"></i>获取课程表单数据
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button type="button" class="btn btn-success w-100" onclick="testCreateCourse()">
                                    <i class="fas fa-plus me-2"></i>创建测试课程
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button type="button" class="btn btn-info w-100" onclick="testGetCourseDetail()">
                                    <i class="fas fa-eye me-2"></i>获取课程详情
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 班级管理API测试 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-chalkboard-teacher me-2"></i>班级管理API测试
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <button type="button" class="btn btn-primary w-100" onclick="testClassFormData()">
                                    <i class="fas fa-download me-2"></i>获取班级表单数据
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button type="button" class="btn btn-success w-100" onclick="testCreateClass()">
                                    <i class="fas fa-plus me-2"></i>创建测试班级
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button type="button" class="btn btn-info w-100" onclick="testGetClassDetail()">
                                    <i class="fas fa-eye me-2"></i>获取班级详情
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 学生管理API测试 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-user-graduate me-2"></i>学生管理API测试
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <button type="button" class="btn btn-primary w-100" onclick="testStudentFormData()">
                                    <i class="fas fa-download me-2"></i>获取学生表单数据
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button type="button" class="btn btn-success w-100" onclick="testCreateStudent()">
                                    <i class="fas fa-plus me-2"></i>创建测试学生
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button type="button" class="btn btn-info w-100" onclick="testGetStudentDetail()">
                                    <i class="fas fa-eye me-2"></i>获取学生详情
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 页面访问测试 -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-globe me-2"></i>页面访问测试
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <a href="/admin/academic/courses" class="btn btn-outline-primary w-100" target="_blank">
                                    <i class="fas fa-book me-2"></i>课程管理页面
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="/admin/academic/classes" class="btn btn-outline-primary w-100" target="_blank">
                                    <i class="fas fa-chalkboard-teacher me-2"></i>班级管理页面
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="/admin/students" class="btn btn-outline-primary w-100" target="_blank">
                                    <i class="fas fa-user-graduate me-2"></i>学生管理页面
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="/admin/dashboard" class="btn btn-outline-primary w-100" target="_blank">
                                    <i class="fas fa-tachometer-alt me-2"></i>管理后台首页
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/api-client.js"></script>
    
    <script>
        // 显示测试结果
        function showTestResult(title, success, data, error = null) {
            const resultDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            
            const alertClass = success ? 'alert-success' : 'alert-danger';
            const icon = success ? 'fa-check-circle' : 'fa-exclamation-circle';
            
            const resultHtml = `
                <div class="alert ${alertClass} alert-dismissible fade show">
                    <i class="fas ${icon} me-2"></i>
                    <strong>${title}</strong> - ${timestamp}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    <hr>
                    ${success ? 
                        `<pre class="mb-0"><code>${JSON.stringify(data, null, 2)}</code></pre>` : 
                        `<div class="text-danger">错误: ${error}</div>`
                    }
                </div>
            `;
            
            resultDiv.insertAdjacentHTML('afterbegin', resultHtml);
        }

        // 课程管理API测试
        async function testCourseFormData() {
            try {
                const response = await apiClient.get('/api/courses/form-data');
                showTestResult('获取课程表单数据', true, response);
            } catch (error) {
                showTestResult('获取课程表单数据', false, null, error.message);
            }
        }

        async function testCreateCourse() {
            try {
                const courseData = {
                    courseName: '测试课程_' + Date.now(),
                    courseCode: 'TEST' + Date.now(),
                    credits: 3,
                    courseType: '必修课',
                    semester: '2024春季',
                    description: '这是一个API测试创建的课程',
                    status: 1
                };
                
                const response = await apiClient.post('/api/courses', courseData);
                showTestResult('创建测试课程', true, response);
            } catch (error) {
                showTestResult('创建测试课程', false, null, error.message);
            }
        }

        async function testGetCourseDetail() {
            try {
                // 假设课程ID为1，实际使用时需要先获取真实的课程ID
                const response = await apiClient.get('/api/courses/1');
                showTestResult('获取课程详情', true, response);
            } catch (error) {
                showTestResult('获取课程详情', false, null, error.message);
            }
        }

        // 班级管理API测试
        async function testClassFormData() {
            try {
                const response = await apiClient.get('/api/classes/form-data');
                showTestResult('获取班级表单数据', true, response);
            } catch (error) {
                showTestResult('获取班级表单数据', false, null, error.message);
            }
        }

        async function testCreateClass() {
            try {
                const classData = {
                    className: '测试班级_' + Date.now(),
                    grade: '2024级',
                    major: '计算机科学与技术',
                    maxStudents: 30,
                    description: '这是一个API测试创建的班级',
                    status: 1
                };
                
                const response = await apiClient.post('/api/classes', classData);
                showTestResult('创建测试班级', true, response);
            } catch (error) {
                showTestResult('创建测试班级', false, null, error.message);
            }
        }

        async function testGetClassDetail() {
            try {
                // 假设班级ID为1，实际使用时需要先获取真实的班级ID
                const response = await apiClient.get('/api/classes/1');
                showTestResult('获取班级详情', true, response);
            } catch (error) {
                showTestResult('获取班级详情', false, null, error.message);
            }
        }

        // 学生管理API测试
        async function testStudentFormData() {
            try {
                const response = await apiClient.get('/api/students/form-data');
                showTestResult('获取学生表单数据', true, response);
            } catch (error) {
                showTestResult('获取学生表单数据', false, null, error.message);
            }
        }

        async function testCreateStudent() {
            try {
                const studentData = {
                    studentNo: 'TEST' + Date.now(),
                    grade: '2024级',
                    major: '计算机科学与技术',
                    classId: 1, // 假设班级ID为1
                    academicStatus: 1
                };
                
                const response = await apiClient.post('/api/students', studentData);
                showTestResult('创建测试学生', true, response);
            } catch (error) {
                showTestResult('创建测试学生', false, null, error.message);
            }
        }

        async function testGetStudentDetail() {
            try {
                // 假设学生ID为1，实际使用时需要先获取真实的学生ID
                const response = await apiClient.get('/api/students/1');
                showTestResult('获取学生详情', true, response);
            } catch (error) {
                showTestResult('获取学生详情', false, null, error.message);
            }
        }

        // 页面加载完成后显示欢迎信息
        document.addEventListener('DOMContentLoaded', () => {
            showTestResult('页面加载完成', true, {
                message: 'API测试页面已准备就绪',
                timestamp: new Date().toISOString(),
                availableTests: [
                    '课程管理API测试',
                    '班级管理API测试', 
                    '学生管理API测试',
                    '页面访问测试'
                ]
            });
        });
    </script>
</body>
</html>
