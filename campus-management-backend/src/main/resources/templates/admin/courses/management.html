<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/admin :: html}"
      lang="zh-CN">
<head th:replace="~{layout/admin :: head}">
    <th:block th:fragment="head-extra">
        <title>课程管理 - 智慧校园管理系统</title>
        <!-- DataTables CSS -->
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
        <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">
        <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">
        
        <!-- 课程管理专用样式 -->
        <style>
            .course-card {
                transition: transform 0.2s ease-in-out;
                border: none;
                box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            }
            .course-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            }
            .course-type-badge {
                font-size: 0.75rem;
                padding: 0.25rem 0.5rem;
            }
            .course-status-badge {
                font-size: 0.7rem;
                padding: 0.2rem 0.4rem;
            }
            .search-filters {
                background: #f8f9fa;
                border-radius: 0.5rem;
                padding: 1rem;
                margin-bottom: 1rem;
            }
            .batch-actions {
                background: #e3f2fd;
                border-radius: 0.5rem;
                padding: 0.75rem;
                margin-bottom: 1rem;
                display: none;
            }
            .table-container {
                background: white;
                border-radius: 0.5rem;
                box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            }
            .credit-badge {
                background: linear-gradient(45deg, #007bff, #0056b3);
                color: white;
                font-weight: bold;
            }
        </style>
    </th:block>
</head>
<body>
    <div th:fragment="content">
        <!-- 页面标题和操作按钮 -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h3 mb-0">
                    <i class="fas fa-book me-2 text-primary"></i>课程管理
                </h1>
                <p class="text-muted mb-0">管理课程信息、课程安排和选课设置</p>
            </div>
            <div class="d-flex gap-2">
                <button type="button" class="btn btn-outline-info" onclick="refreshCourseData()">
                    <i class="fas fa-sync-alt me-2"></i>刷新数据
                </button>
                <button type="button" class="btn btn-outline-success" onclick="exportCourses()">
                    <i class="fas fa-download me-2"></i>导出课程
                </button>
                <button type="button" class="btn btn-primary" onclick="showCreateCourseModal()">
                    <i class="fas fa-plus me-2"></i>添加课程
                </button>
            </div>
        </div>

        <!-- 错误提示区域 -->
        <div id="alertContainer"></div>

        <!-- 搜索和筛选区域 -->
        <div class="search-filters">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">课程名称/编号</label>
                    <input type="text" class="form-control" id="searchKeyword" placeholder="输入关键词搜索">
                </div>
                <div class="col-md-2">
                    <label class="form-label">课程类型</label>
                    <select class="form-select" id="courseTypeFilter">
                        <option value="">全部类型</option>
                        <option value="必修">必修课</option>
                        <option value="选修">选修课</option>
                        <option value="实践">实践课</option>
                        <option value="通识">通识课</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">课程状态</label>
                    <select class="form-select" id="statusFilter">
                        <option value="">全部状态</option>
                        <option value="1">启用</option>
                        <option value="0">禁用</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">学期</label>
                    <select class="form-select" id="semesterFilter">
                        <option value="">全部学期</option>
                        <option value="2024-1">2024年春季</option>
                        <option value="2024-2">2024年秋季</option>
                        <option value="2025-1">2025年春季</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">&nbsp;</label>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-primary" onclick="applyFilters()">
                            <i class="fas fa-search me-1"></i>搜索
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="resetFilters()">
                            <i class="fas fa-undo me-1"></i>重置
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 批量操作区域 -->
        <div class="batch-actions" id="batchActions">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <span class="fw-bold">已选择 <span id="selectedCount">0</span> 门课程</span>
                </div>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-sm btn-success" onclick="batchEnable()">
                        <i class="fas fa-check me-1"></i>批量启用
                    </button>
                    <button type="button" class="btn btn-sm btn-warning" onclick="batchDisable()">
                        <i class="fas fa-ban me-1"></i>批量禁用
                    </button>
                    <button type="button" class="btn btn-sm btn-danger" onclick="batchDelete()">
                        <i class="fas fa-trash me-1"></i>批量删除
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="clearSelection()">
                        <i class="fas fa-times me-1"></i>取消选择
                    </button>
                </div>
            </div>
        </div>

        <!-- 课程统计卡片 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-primary mb-2">
                            <i class="fas fa-book fa-2x"></i>
                        </div>
                        <h5 class="card-title mb-1">总课程数</h5>
                        <h3 class="text-primary mb-0" id="totalCourses">0</h3>
                        <small class="text-muted">系统课程总数</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-success mb-2">
                            <i class="fas fa-play-circle fa-2x"></i>
                        </div>
                        <h5 class="card-title mb-1">进行中</h5>
                        <h3 class="text-success mb-0" id="activeCourses">0</h3>
                        <small class="text-muted">正在进行的课程</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-info mb-2">
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                        <h5 class="card-title mb-1">选课人数</h5>
                        <h3 class="text-info mb-0" id="totalEnrollments">0</h3>
                        <small class="text-muted">总选课人数</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <div class="text-warning mb-2">
                            <i class="fas fa-plus-circle fa-2x"></i>
                        </div>
                        <h5 class="card-title mb-1">本学期新增</h5>
                        <h3 class="text-warning mb-0" id="newCourses">0</h3>
                        <small class="text-muted">本学期新增课程</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- 课程数据表格 -->
        <div class="table-container">
            <div class="card border-0">
                <div class="card-header bg-white border-0 py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-table me-2"></i>课程列表
                        </h5>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="toggleColumns()">
                                <i class="fas fa-columns me-1"></i>列显示
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-info" onclick="refreshTable()">
                                <i class="fas fa-sync-alt me-1"></i>刷新表格
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="coursesTable" class="table table-hover table-striped">
                            <thead class="table-light">
                                <tr>
                                    <th width="40">
                                        <input type="checkbox" class="form-check-input" id="selectAll">
                                    </th>
                                    <th>课程编号</th>
                                    <th>课程名称</th>
                                    <th>课程类型</th>
                                    <th>学分</th>
                                    <th>学时</th>
                                    <th>授课教师</th>
                                    <th>选课人数</th>
                                    <th>状态</th>
                                    <th>创建时间</th>
                                    <th width="200">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 数据将通过AJAX加载 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建课程模态框 -->
    <div class="modal fade" id="createCourseModal" tabindex="-1" aria-labelledby="createCourseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createCourseModalLabel">
                        <i class="fas fa-plus me-2"></i>添加课程
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createCourseForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="courseCode" class="form-label">课程编号 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="courseCode" name="courseCode" required>
                                <div class="invalid-feedback">请输入课程编号</div>
                            </div>
                            <div class="col-md-6">
                                <label for="courseName" class="form-label">课程名称 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="courseName" name="courseName" required>
                                <div class="invalid-feedback">请输入课程名称</div>
                            </div>
                            <div class="col-md-6">
                                <label for="courseType" class="form-label">课程类型 <span class="text-danger">*</span></label>
                                <select class="form-select" id="courseType" name="courseType" required>
                                    <option value="">请选择课程类型</option>
                                    <option value="必修">必修课</option>
                                    <option value="选修">选修课</option>
                                    <option value="实践">实践课</option>
                                    <option value="通识">通识课</option>
                                </select>
                                <div class="invalid-feedback">请选择课程类型</div>
                            </div>
                            <div class="col-md-6">
                                <label for="credits" class="form-label">学分 <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="credits" name="credits" min="1" max="10" required>
                                <div class="invalid-feedback">请输入学分(1-10)</div>
                            </div>
                            <div class="col-md-6">
                                <label for="hours" class="form-label">学时 <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="hours" name="hours" min="1" required>
                                <div class="invalid-feedback">请输入学时</div>
                            </div>
                            <div class="col-md-6">
                                <label for="maxStudents" class="form-label">最大选课人数</label>
                                <input type="number" class="form-control" id="maxStudents" name="maxStudents" min="1" value="50">
                            </div>
                            <div class="col-md-6">
                                <label for="teacherId" class="form-label">授课教师</label>
                                <select class="form-select" id="teacherId" name="teacherId">
                                    <option value="">请选择教师</option>
                                    <!-- 教师选项将通过AJAX加载 -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="semester" class="form-label">学期</label>
                                <select class="form-select" id="semester" name="semester">
                                    <option value="2024-1">2024年春季</option>
                                    <option value="2024-2">2024年秋季</option>
                                    <option value="2025-1" selected>2025年春季</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label for="description" class="form-label">课程描述</label>
                                <textarea class="form-control" id="description" name="description" rows="3" placeholder="请输入课程描述"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label for="courseStatus" class="form-label">课程状态</label>
                                <select class="form-select" id="courseStatus" name="status">
                                    <option value="1">启用</option>
                                    <option value="0">禁用</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="createCourse()">
                        <i class="fas fa-save me-1"></i>保存
                    </button>
                </div>
            </div>
        </div>
    </div>

    <th:block th:fragment="scripts">
        <!-- DataTables JS -->
        <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
        <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
        <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>
        
        <!-- 课程管理脚本 -->
        <script th:src="@{/js/modules/course-management-enhanced.js}"></script>
        
        <!-- 页面初始化脚本 -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // 设置当前页面标识
                document.body.setAttribute('data-current-page', 'courses');
                
                // 初始化课程管理模块
                if (window.CourseManagementEnhanced) {
                    window.CourseManagementEnhanced.init();
                } else {
                    console.error('课程管理模块未加载');
                }
            });
        </script>
    </th:block>
</body>
</html>
