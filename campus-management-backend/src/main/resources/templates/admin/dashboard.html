<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>仪表盘 - 智慧校园管理系统</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- 自定义CSS -->
    <link th:href="@{/css/admin.css}" rel="stylesheet">

    <!-- 引入组件样式 -->
    <th:block th:replace="~{components/sidebar :: sidebar-style}"></th:block>
    <th:block th:replace="~{components/topbar :: topbar-style}"></th:block>
    <th:block th:replace="~{components/admin/admin-components :: admin-style}"></th:block>
</head>
<body>
    <!-- 布局容器 -->
    <div class="wrapper">
        <!-- 左侧导航栏 -->
        <th:block th:replace="~{components/sidebar :: sidebar}"></th:block>

        <!-- 主内容区域 -->
        <div class="content" id="content">
            <!-- 顶部导航栏 -->
            <th:block th:replace="~{components/topbar :: topbar}"></th:block>

            <!-- 页面内容包装器 -->
            <div class="content-wrapper">
        <!-- 页面标题 -->
        <div th:replace="~{components/admin/admin-components :: page-header(
            title='仪表盘',
            icon='fas fa-tachometer-alt',
            showAddButton=false,
            addButtonText='',
            addButtonTarget=''
        )}"></div>

        <!-- 错误提示 -->
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span th:text="${error}">加载数据时发生错误</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- 统计卡片 -->
        <div class="row mb-4">
            <!-- 学生总数 -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary shadow h-100 py-2 stats-card" data-aos="fade-up">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    学生总数
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800 counter"
                                     th:text="${stats?.totalStudents ?: 0}"
                                     th:data-target="${stats?.totalStudents ?: 0}">
                                    0
                                </div>
                                <div class="text-xs text-muted mt-1">
                                    <span class="text-success mr-2">
                                        <i class="fas fa-user-graduate"></i>
                                        <span th:text="${stats?.totalTeachers ?: 0}">0</span>
                                    </span>
                                    教师数量
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-user-graduate fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 课程总数 -->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2 stats-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                    课程总数
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800 counter"
                                     th:text="${stats?.totalCourses ?: 0}"
                                     th:data-target="${stats?.totalCourses ?: 0}">
                                    0
                                </div>
                                <div class="text-xs text-muted mt-1">
                                    <span class="text-info mr-2">
                                        <i class="fas fa-calendar-check"></i>
                                        <span th:text="${stats?.activeSchedules ?: 0}">0</span>
                                    </span>
                                    活跃课表
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-book fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-info shadow h-100 py-2 stats-card" data-aos="fade-up" data-aos-delay="300">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                    班级总数
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800 counter"
                                     th:text="${stats?.totalClasses ?: 0}"
                                     th:data-target="${stats?.totalClasses ?: 0}">
                                    0
                                </div>
                                <div class="text-xs text-muted mt-1">
                                    <span class="text-primary mr-2">
                                        <i class="fas fa-users"></i>
                                        <span th:text="${stats?.totalUsers ?: 0}">0</span>
                                    </span>
                                    系统用户
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-users fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-warning shadow h-100 py-2 stats-card" data-aos="fade-up" data-aos-delay="400">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                    本月收费
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" th:text="${stats?.monthlyRevenue ?: '¥0.00'}">
                                    ¥0.00
                                </div>
                                <div class="text-xs text-muted mt-1">
                                    <span class="text-warning mr-2">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <span th:text="${stats?.pendingPayments ?: 0}">0</span>
                                    </span>
                                    待缴费
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-money-bill-wave fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 第二行快速统计卡片 -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-danger shadow h-100 py-2 stats-card" data-aos="fade-up" data-aos-delay="500">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                    今日缴费
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800 counter"
                                     th:text="${stats?.quickStats?.todayPayments ?: 0}"
                                     th:data-target="${stats?.quickStats?.todayPayments ?: 0}">
                                    0
                                </div>
                                <div class="text-xs text-muted mt-1">
                                    <span class="text-success">
                                        <i class="fas fa-check-circle"></i>
                                        今日收入: <span th:text="${stats?.quickStats?.todayRevenue != null ? '¥' + stats.quickStats.todayRevenue : '¥0.00'}">¥0.00</span>
                                    </span>
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-credit-card fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-secondary shadow h-100 py-2 stats-card" data-aos="fade-up" data-aos-delay="600">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
                                    在线用户
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800 counter"
                                     th:text="${stats?.quickStats?.onlineUsers ?: 0}"
                                     th:data-target="${stats?.quickStats?.onlineUsers ?: 0}">
                                    0
                                </div>
                                <div class="text-xs text-muted mt-1">
                                    <span class="text-success">
                                        <i class="fas fa-circle text-success"></i>
                                        系统运行正常
                                    </span>
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-user-clock fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-dark shadow h-100 py-2 stats-card" data-aos="fade-up" data-aos-delay="700">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-dark text-uppercase mb-1">
                                    系统警告
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800 counter"
                                     th:text="${stats?.quickStats?.systemAlerts ?: 0}"
                                     th:data-target="${stats?.quickStats?.systemAlerts ?: 0}">
                                    0
                                </div>
                                <div class="text-xs text-muted mt-1">
                                    <span class="text-success">
                                        <i class="fas fa-shield-alt"></i>
                                        系统安全
                                    </span>
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-light shadow h-100 py-2 stats-card" data-aos="fade-up" data-aos-delay="800">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-muted text-uppercase mb-1">
                                    数据更新
                                </div>
                                <div class="h6 mb-0 font-weight-bold text-gray-800" id="lastUpdateTime">
                                    刚刚
                                </div>
                                <div class="text-xs text-muted mt-1">
                                    <button class="btn btn-sm btn-outline-primary" onclick="refreshDashboardData()">
                                        <i class="fas fa-sync-alt"></i> 刷新数据
                                    </button>
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-database fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 图表区域 -->
        <div class="row">
            <!-- 学生统计图表 -->
            <div class="col-xl-8 col-lg-7">
                <div class="card shadow mb-4" data-aos="fade-right">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-chart-line mr-2"></i>学生注册统计
                        </h6>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                               data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow">
                                <div class="dropdown-header">操作:</div>
                                <a class="dropdown-item" href="#" onclick="refreshCharts()">
                                    <i class="fas fa-sync-alt mr-2"></i>刷新图表
                                </a>
                                <a class="dropdown-item" href="#" onclick="exportChartData('student')">
                                    <i class="fas fa-download mr-2"></i>导出数据
                                </a>
                                <a class="dropdown-item" href="#" onclick="toggleChartType('studentChart')">
                                    <i class="fas fa-exchange-alt mr-2"></i>切换图表类型
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-area" style="position: relative; height: 320px;">
                            <canvas id="studentChart"></canvas>
                        </div>
                        <div class="mt-3 text-center">
                            <small class="text-muted">
                                <i class="fas fa-info-circle mr-1"></i>
                                显示过去12个月的学生注册趋势
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 课程分布图 -->
            <div class="col-xl-4 col-lg-5">
                <div class="card shadow mb-4" data-aos="fade-left">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-chart-pie mr-2"></i>课程分布
                        </h6>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button"
                               data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow">
                                <div class="dropdown-header">操作:</div>
                                <a class="dropdown-item" href="#" onclick="refreshCharts()">
                                    <i class="fas fa-sync-alt mr-2"></i>刷新图表
                                </a>
                                <a class="dropdown-item" href="#" onclick="exportChartData('course')">
                                    <i class="fas fa-download mr-2"></i>导出数据
                                </a>
                                <a class="dropdown-item" href="#" onclick="toggleChartType('courseChart')">
                                    <i class="fas fa-exchange-alt mr-2"></i>切换图表类型
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-pie pt-4 pb-2" style="position: relative; height: 250px;">
                            <canvas id="courseChart"></canvas>
                        </div>
                        <div class="mt-4 text-center small">
                            <span class="mr-3">
                                <i class="fas fa-circle text-primary"></i> 必修课
                            </span>
                            <span class="mr-3">
                                <i class="fas fa-circle text-success"></i> 选修课
                            </span>
                            <span class="mr-3">
                                <i class="fas fa-circle text-info"></i> 实践课
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 第二行图表 -->
        <div class="row">
            <!-- 年级分布图 -->
            <div class="col-xl-6 col-lg-6">
                <div class="card shadow mb-4" data-aos="fade-up">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-chart-bar mr-2"></i>年级分布统计
                        </h6>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button"
                               data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow">
                                <div class="dropdown-header">操作:</div>
                                <a class="dropdown-item" href="#" onclick="refreshCharts()">
                                    <i class="fas fa-sync-alt mr-2"></i>刷新图表
                                </a>
                                <a class="dropdown-item" href="#" onclick="exportChartData('grade')">
                                    <i class="fas fa-download mr-2"></i>导出数据
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-bar" style="position: relative; height: 280px;">
                            <canvas id="gradeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 收入趋势图 -->
            <div class="col-xl-6 col-lg-6">
                <div class="card shadow mb-4" data-aos="fade-up" data-aos-delay="100">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-chart-area mr-2"></i>收入趋势
                        </h6>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button"
                               data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow">
                                <div class="dropdown-header">操作:</div>
                                <a class="dropdown-item" href="#" onclick="refreshCharts()">
                                    <i class="fas fa-sync-alt mr-2"></i>刷新图表
                                </a>
                                <a class="dropdown-item" href="#" onclick="exportChartData('revenue')">
                                    <i class="fas fa-download mr-2"></i>导出数据
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-area" style="position: relative; height: 280px;">
                            <canvas id="revenueChart"></canvas>
                        </div>
                        <div class="mt-3 text-center">
                            <small class="text-muted">
                                <i class="fas fa-info-circle mr-1"></i>
                                显示过去6个月的收入趋势
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 快速操作和通知 -->
        <div class="row">
            <!-- 快速操作 -->
            <div class="col-lg-6 mb-4">
                <div class="card shadow">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-bolt mr-2"></i>快速操作
                        </h6>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button"
                               data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow">
                                <div class="dropdown-header">更多操作:</div>
                                <a class="dropdown-item" href="/admin/users">
                                    <i class="fas fa-user-cog mr-2"></i>用户管理
                                </a>
                                <a class="dropdown-item" href="/admin/system">
                                    <i class="fas fa-cogs mr-2"></i>系统设置
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#" onclick="showBatchOperations()">
                                    <i class="fas fa-tasks mr-2"></i>批量操作
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6 mb-3">
                                <button type="button" onclick="openStudentModal()"
                                        class="btn btn-primary btn-icon-split w-100 quick-action-btn">
                                    <span class="icon text-white-50">
                                        <i class="fas fa-user-plus"></i>
                                    </span>
                                    <span class="text">添加学生</span>
                                </button>
                            </div>
                            <div class="col-6 mb-3">
                                <button type="button" onclick="openCourseModal()"
                                        class="btn btn-success btn-icon-split w-100 quick-action-btn">
                                    <span class="icon text-white-50">
                                        <i class="fas fa-book-plus"></i>
                                    </span>
                                    <span class="text">添加课程</span>
                                </button>
                            </div>
                            <div class="col-6 mb-3">
                                <button type="button" onclick="openClassModal()"
                                        class="btn btn-info btn-icon-split w-100 quick-action-btn">
                                    <span class="icon text-white-50">
                                        <i class="fas fa-users"></i>
                                    </span>
                                    <span class="text">添加班级</span>
                                </button>
                            </div>
                            <div class="col-6 mb-3">
                                <button type="button" onclick="openScheduleModal()"
                                        class="btn btn-warning btn-icon-split w-100 quick-action-btn">
                                    <span class="icon text-white-50">
                                        <i class="fas fa-calendar-plus"></i>
                                    </span>
                                    <span class="text">安排课程</span>
                                </button>
                            </div>
                            <div class="col-6 mb-3">
                                <button type="button" onclick="openPaymentModal()"
                                        class="btn btn-danger btn-icon-split w-100 quick-action-btn">
                                    <span class="icon text-white-50">
                                        <i class="fas fa-credit-card"></i>
                                    </span>
                                    <span class="text">缴费管理</span>
                                </button>
                            </div>
                            <div class="col-6 mb-3">
                                <button type="button" onclick="openReportModal()"
                                        class="btn btn-secondary btn-icon-split w-100 quick-action-btn">
                                    <span class="icon text-white-50">
                                        <i class="fas fa-chart-line"></i>
                                    </span>
                                    <span class="text">生成报表</span>
                                </button>
                            </div>
                        </div>
                        <div class="text-center mt-2">
                            <small class="text-muted">
                                <i class="fas fa-info-circle mr-1"></i>
                                点击按钮快速访问常用功能
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 系统通知 -->
            <div class="col-lg-6 mb-4">
                <div class="card shadow">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-bell mr-2"></i>系统通知
                            <span class="badge badge-danger badge-pill ml-2" th:if="${stats?.systemNotifications != null and stats.systemNotifications.size() > 0}" th:text="${stats.systemNotifications.size()}">0</span>
                        </h6>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button"
                               data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow">
                                <div class="dropdown-header">通知操作:</div>
                                <a class="dropdown-item" href="#" onclick="markAllAsRead()">
                                    <i class="fas fa-check-double mr-2"></i>全部标记已读
                                </a>
                                <a class="dropdown-item" href="#" onclick="refreshNotifications()">
                                    <i class="fas fa-sync-alt mr-2"></i>刷新通知
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="/admin/notifications">
                                    <i class="fas fa-list mr-2"></i>查看全部
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div class="list-group list-group-flush" id="notificationsList">
                            <!-- 使用Thymeleaf渲染真实通知数据 -->
                            <div th:if="${stats?.systemNotifications != null and !stats.systemNotifications.empty}">
                                <div th:each="notification : ${stats.systemNotifications}"
                                     class="list-group-item notification-item"
                                     th:classappend="${notification.isRead} ? 'read' : 'unread'">
                                    <div class="d-flex w-100 justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1 d-flex align-items-center">
                                                <i class="fas fa-circle text-primary mr-2"
                                                   th:classappend="${notification.isRead} ? 'text-muted' : 'text-primary'"
                                                   style="font-size: 0.5rem;"></i>
                                                <span th:text="${notification.title}">通知标题</span>
                                            </h6>
                                            <p class="mb-1 text-muted" th:text="${notification.content}">通知内容</p>
                                            <small class="text-muted">
                                                <i class="fas fa-user mr-1"></i>
                                                <span th:text="${notification.sender}">发送者</span>
                                                <span class="mx-2">•</span>
                                                <i class="fas fa-clock mr-1"></i>
                                                <span th:text="${#temporals.format(notification.createTime, 'MM-dd HH:mm')}">时间</span>
                                            </small>
                                        </div>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-link text-muted" type="button"
                                                    data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-right">
                                                <li><a class="dropdown-item" href="#" onclick="markAsRead(this)">
                                                    <i class="fas fa-check mr-2"></i>标记已读
                                                </a></li>
                                                <li><a class="dropdown-item" href="#" onclick="deleteNotification(this)">
                                                    <i class="fas fa-trash mr-2"></i>删除
                                                </a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 默认通知（当没有真实数据时显示） -->
                            <div th:if="${stats?.systemNotifications == null or stats.systemNotifications.empty}">
                                <div class="list-group-item notification-item unread">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">
                                            <i class="fas fa-circle text-primary mr-2" style="font-size: 0.5rem;"></i>
                                            欢迎使用智慧校园管理系统
                                        </h6>
                                        <small>刚刚</small>
                                    </div>
                                    <p class="mb-1">系统已成功启动，所有功能正常运行。</p>
                                    <small class="text-muted">
                                        <i class="fas fa-user mr-1"></i>系统管理员
                                    </small>
                                </div>
                                <div class="list-group-item notification-item read">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">
                                            <i class="fas fa-circle text-muted mr-2" style="font-size: 0.5rem;"></i>
                                            数据初始化完成
                                        </h6>
                                        <small>1小时前</small>
                                    </div>
                                    <p class="mb-1">系统基础数据已成功初始化。</p>
                                    <small class="text-muted">
                                        <i class="fas fa-user mr-1"></i>系统
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <a href="/admin/notifications" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-list mr-1"></i>查看全部通知
                            </a>
                            <button class="btn btn-sm btn-outline-secondary ml-2" onclick="refreshNotifications()">
                                <i class="fas fa-sync-alt mr-1"></i>刷新
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 最近活动区域 -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow mb-4" data-aos="fade-up">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">
                            <i class="fas fa-history mr-2"></i>最近活动
                        </h6>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button"
                               data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow">
                                <div class="dropdown-header">活动操作:</div>
                                <a class="dropdown-item" href="#" onclick="refreshActivities()">
                                    <i class="fas fa-sync-alt mr-2"></i>刷新活动
                                </a>
                                <a class="dropdown-item" href="#" onclick="exportActivities()">
                                    <i class="fas fa-download mr-2"></i>导出活动日志
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="/admin/logs">
                                    <i class="fas fa-list mr-2"></i>查看完整日志
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="timeline" id="activitiesTimeline">
                            <!-- 使用Thymeleaf渲染真实活动数据 -->
                            <div th:if="${stats?.recentActivities != null and !stats.recentActivities.empty}">
                                <div th:each="activity, iterStat : ${stats.recentActivities}"
                                     class="timeline-item"
                                     th:classappend="${iterStat.last} ? 'timeline-item-last' : ''">
                                    <div class="timeline-marker">
                                        <i class="fas fa-circle"
                                           th:classappend="${activity.type == '系统统计'} ? 'text-primary' :
                                                          (${activity.type == '课程统计'} ? 'text-success' :
                                                          (${activity.type == '缴费统计'} ? 'text-warning' : 'text-info'))"></i>
                                    </div>
                                    <div class="timeline-content">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1" th:text="${activity.type}">活动类型</h6>
                                                <p class="mb-1 text-muted" th:text="${activity.description}">活动描述</p>
                                                <small class="text-muted">
                                                    <i class="fas fa-user mr-1"></i>
                                                    <span th:text="${activity.user}">用户</span>
                                                    <span class="mx-2">•</span>
                                                    <i class="fas fa-clock mr-1"></i>
                                                    <span th:text="${#temporals.format(activity.timestamp, 'MM-dd HH:mm')}">时间</span>
                                                </small>
                                            </div>
                                            <div class="activity-actions">
                                                <button class="btn btn-sm btn-outline-secondary"
                                                        onclick="showActivityDetails(this)"
                                                        th:data-activity="${activity.description}">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 默认活动（当没有真实数据时显示） -->
                            <div th:if="${stats?.recentActivities == null or stats.recentActivities.empty}">
                                <div class="timeline-item">
                                    <div class="timeline-marker">
                                        <i class="fas fa-circle text-success"></i>
                                    </div>
                                    <div class="timeline-content">
                                        <h6 class="mb-1">系统启动</h6>
                                        <p class="mb-1 text-muted">智慧校园管理系统已成功启动</p>
                                        <small class="text-muted">
                                            <i class="fas fa-user mr-1"></i>系统
                                            <span class="mx-2">•</span>
                                            <i class="fas fa-clock mr-1"></i>刚刚
                                        </small>
                                    </div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-marker">
                                        <i class="fas fa-circle text-primary"></i>
                                    </div>
                                    <div class="timeline-content">
                                        <h6 class="mb-1">数据加载</h6>
                                        <p class="mb-1 text-muted">仪表盘数据已成功加载</p>
                                        <small class="text-muted">
                                            <i class="fas fa-user mr-1"></i>系统
                                            <span class="mx-2">•</span>
                                            <i class="fas fa-clock mr-1"></i>1分钟前
                                        </small>
                                    </div>
                                </div>
                                <div class="timeline-item timeline-item-last">
                                    <div class="timeline-marker">
                                        <i class="fas fa-circle text-info"></i>
                                    </div>
                                    <div class="timeline-content">
                                        <h6 class="mb-1">用户登录</h6>
                                        <p class="mb-1 text-muted">管理员登录系统</p>
                                        <small class="text-muted">
                                            <i class="fas fa-user mr-1"></i>admin
                                            <span class="mx-2">•</span>
                                            <i class="fas fa-clock mr-1"></i>5分钟前
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <button class="btn btn-outline-primary" onclick="loadMoreActivities()">
                                <i class="fas fa-plus mr-1"></i>加载更多活动
                            </button>
                            <button class="btn btn-outline-secondary ml-2" onclick="refreshActivities()">
                                <i class="fas fa-sync-alt mr-1"></i>刷新
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入弹窗组件 -->
    <!-- TODO: 添加模态框组件 -->

    <th:block th:fragment="scripts">
        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

        <!-- 引入API客户端 -->
        <script th:src="@{/js/api-client.js}"></script>

        <!-- 引入仪表盘数据管理模块 -->
        <script th:src="@{/js/modules/dashboard-data.js}"></script>
    </th:block>
            </div>
        </div>
    </div>

    <!-- 退出登录确认模态框 -->
    <th:block th:replace="~{components/topbar :: logout-modal}"></th:block>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

    <!-- 引入侧边栏脚本 -->
    <th:block th:replace="~{components/sidebar :: sidebar-script}"></th:block>

    <!-- 仪表盘页面初始化脚本 -->
    <script>
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 设置当前页面标识
            document.body.setAttribute('data-current-page', 'dashboard');
            console.log('仪表盘页面已加载，数据管理器将自动初始化');
        });
    </script>
</body>
</html>
