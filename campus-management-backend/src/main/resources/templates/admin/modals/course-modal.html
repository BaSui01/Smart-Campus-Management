<!-- 课程添加/编辑弹窗 -->
<div class="modal fade" id="courseModal" tabindex="-1" aria-labelledby="courseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="courseModalLabel">
                    <i class="fas fa-book-open"></i> 添加课程
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- 填写说明 -->
                <div class="alert alert-info mb-3" role="alert">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="alert-heading mb-2">
                                <i class="fas fa-lightbulb"></i> 填写提示
                            </h6>
                            <ul class="mb-0 small">
                                <li>课程代码建议使用字母+数字组合</li>
                                <li>学分数影响学生的学分统计</li>
                                <li>课程类型影响培养方案计算</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="alert-heading mb-2">
                                <i class="fas fa-exclamation-triangle"></i> 注意事项
                            </h6>
                            <ul class="mb-0 small">
                                <li>课程代码一旦确定不可修改</li>
                                <li>请确保课程信息准确无误</li>
                                <li>先修课程影响选课顺序</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <form id="courseModalForm" data-auto-save="course-modal-form">
                    <!-- 基本信息 -->
                    <h6 class="text-primary mb-3">
                        <i class="fas fa-info-circle"></i> 基本信息
                    </h6>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modalCourseCode" class="form-label">课程代码 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="modalCourseCode" name="courseCode" 
                                       placeholder="如：CS101" required>
                                <div class="form-text">建议格式：专业缩写+数字</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modalCourseName" class="form-label">课程名称 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="modalCourseName" name="courseName" 
                                       placeholder="请输入课程名称" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modalCourseNameEn" class="form-label">英文名称</label>
                                <input type="text" class="form-control" id="modalCourseNameEn" name="courseNameEn" 
                                       placeholder="请输入英文名称">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modalCredits" class="form-label">学分 <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="modalCredits" name="credits" 
                                       min="0.5" max="10" step="0.5" placeholder="如：3" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modalCourseType" class="form-label">课程类型 <span class="text-danger">*</span></label>
                                <select class="form-select" id="modalCourseType" name="courseType" required>
                                    <option value="">请选择课程类型</option>
                                    <option value="必修课">必修课</option>
                                    <option value="选修课">选修课</option>
                                    <option value="专业课">专业课</option>
                                    <option value="公共课">公共课</option>
                                    <option value="实践课">实践课</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modalDepartment" class="form-label">开课院系 <span class="text-danger">*</span></label>
                                <select class="form-select" id="modalDepartment" name="department" required>
                                    <option value="">请选择院系</option>
                                    <option value="计算机学院">计算机学院</option>
                                    <option value="软件学院">软件学院</option>
                                    <option value="信息学院">信息学院</option>
                                    <option value="数学学院">数学学院</option>
                                    <option value="外语学院">外语学院</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 教学信息 -->
                    <hr>
                    <h6 class="text-primary mb-3">
                        <i class="fas fa-chalkboard-teacher"></i> 教学信息
                    </h6>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="modalTotalHours" class="form-label">总学时</label>
                                <input type="number" class="form-control" id="modalTotalHours" name="totalHours" 
                                       min="16" max="200" placeholder="如：48">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="modalTheoryHours" class="form-label">理论学时</label>
                                <input type="number" class="form-control" id="modalTheoryHours" name="theoryHours" 
                                       min="0" placeholder="如：32">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="modalPracticeHours" class="form-label">实践学时</label>
                                <input type="number" class="form-control" id="modalPracticeHours" name="practiceHours" 
                                       min="0" placeholder="如：16">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modalExamType" class="form-label">考核方式</label>
                                <select class="form-select" id="modalExamType" name="examType">
                                    <option value="考试">考试</option>
                                    <option value="考查">考查</option>
                                    <option value="论文">论文</option>
                                    <option value="实践">实践</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modalPrerequisites" class="form-label">先修课程</label>
                                <input type="text" class="form-control" id="modalPrerequisites" name="prerequisites" 
                                       placeholder="如：高等数学，线性代数">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modalSemester" class="form-label">建议学期</label>
                                <select class="form-select" id="modalSemester" name="semester">
                                    <option value="">请选择学期</option>
                                    <option value="第1学期">第1学期</option>
                                    <option value="第2学期">第2学期</option>
                                    <option value="第3学期">第3学期</option>
                                    <option value="第4学期">第4学期</option>
                                    <option value="第5学期">第5学期</option>
                                    <option value="第6学期">第6学期</option>
                                    <option value="第7学期">第7学期</option>
                                    <option value="第8学期">第8学期</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modalStatus" class="form-label">课程状态</label>
                                <select class="form-select" id="modalStatus" name="status">
                                    <option value="正常" selected>正常</option>
                                    <option value="暂停">暂停</option>
                                    <option value="停开">停开</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="modalDescription" class="form-label">课程简介</label>
                        <textarea class="form-control" id="modalDescription" name="description" rows="3" 
                                  placeholder="请输入课程简介、教学目标等"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> 取消
                </button>
                <button type="button" class="btn btn-outline-secondary" id="resetCourseForm">
                    <i class="fas fa-undo"></i> 重置
                </button>
                <button type="button" class="btn btn-primary" id="saveCourse">
                    <i class="fas fa-save"></i> 保存课程
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// 课程弹窗相关功能
document.addEventListener('DOMContentLoaded', function() {
    const courseModal = document.getElementById('courseModal');
    const courseForm = document.getElementById('courseModalForm');
    const saveBtn = document.getElementById('saveCourse');
    const resetBtn = document.getElementById('resetCourseForm');

    // 学时自动计算
    function calculateTotalHours() {
        const theoryHours = parseInt(document.getElementById('modalTheoryHours').value) || 0;
        const practiceHours = parseInt(document.getElementById('modalPracticeHours').value) || 0;
        const totalHours = theoryHours + practiceHours;
        
        if (totalHours > 0) {
            document.getElementById('modalTotalHours').value = totalHours;
        }
    }

    document.getElementById('modalTheoryHours').addEventListener('input', calculateTotalHours);
    document.getElementById('modalPracticeHours').addEventListener('input', calculateTotalHours);

    // 保存按钮点击事件
    saveBtn.addEventListener('click', function() {
        if (!FormUtils.validateForm(courseForm)) {
            return;
        }

        // 设置加载状态
        this.disabled = true;
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 保存中...';

        // 模拟保存
        setTimeout(() => {
            this.disabled = false;
            this.innerHTML = '<i class="fas fa-save"></i> 保存课程';
            
            FormUtils.showAlert('课程信息保存成功！', 'success');
            FormUtils.clearSavedForm('course-modal-form');
            
            // 关闭弹窗
            bootstrap.Modal.getInstance(courseModal).hide();
            
            // 重置表单
            courseForm.reset();
            FormUtils.resetFormValidation(courseForm);
            
            // 刷新课程列表（如果在课程管理页面）
            if (typeof refreshCourseList === 'function') {
                refreshCourseList();
            }
        }, 2000);
    });

    // 重置按钮点击事件
    resetBtn.addEventListener('click', function() {
        courseForm.reset();
        FormUtils.resetFormValidation(courseForm);
        FormUtils.clearSavedForm('course-modal-form');
    });

    // 弹窗关闭时重置表单
    courseModal.addEventListener('hidden.bs.modal', function() {
        courseForm.reset();
        FormUtils.resetFormValidation(courseForm);
    });
});

// 打开课程添加弹窗的函数
function openCourseModal(courseData = null) {
    const modal = new bootstrap.Modal(document.getElementById('courseModal'));
    const form = document.getElementById('courseModalForm');
    const title = document.getElementById('courseModalLabel');
    
    if (courseData) {
        // 编辑模式
        title.innerHTML = '<i class="fas fa-book-edit"></i> 编辑课程';
        
        // 填充表单数据
        Object.keys(courseData).forEach(key => {
            const field = form.querySelector(`[name="${key}"]`);
            if (field) {
                field.value = courseData[key];
            }
        });
    } else {
        // 添加模式
        title.innerHTML = '<i class="fas fa-book-open"></i> 添加课程';
        form.reset();
    }
    
    modal.show();
}
</script>
