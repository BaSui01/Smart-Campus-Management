<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>
    <!-- Admin页面头部组件 -->
    <div th:fragment="page-header(title, icon, showAddButton, addButtonText, addButtonTarget)" class="d-flex justify-content-between align-items-center mb-4">
        <h1>
            <i th:class="${icon ?: 'fas fa-cog'}" th:if="${icon}"></i>
            <span th:text="${title}">页面标题</span>
        </h1>
        <button th:if="${showAddButton}" 
                type="button" 
                class="btn btn-primary" 
                th:data-bs-target="${addButtonTarget}"
                data-bs-toggle="modal">
            <i class="fas fa-plus"></i>
            <span th:text="${addButtonText ?: '添加'}">添加</span>
        </button>
    </div>

    <!-- 统计卡片组件 -->
    <div th:fragment="stat-cards(stats)" class="row mb-4">
        <div th:each="stat : ${stats}" th:class="'col-xl-' + (${stats.size() <= 4} ? (12 / ${stats.size()}) : 3) + ' col-md-6 mb-3'">
            <div class="card stat-card" th:classappend="${stat.type}">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="stat-label" th:text="${stat.label}">标签</div>
                            <div class="stat-number" th:text="${stat.value}">0</div>
                        </div>
                        <div class="align-self-center">
                            <i th:class="${stat.icon} + ' fa-2x'" th:if="${stat.icon}"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 搜索筛选组件 -->
    <div th:fragment="search-filter(formAction, filters)" class="card mb-4 shadow-sm">
        <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center">
                <h6 class="mb-0 text-primary">
                    <i class="fas fa-filter me-2"></i>筛选与操作
                </h6>
            </div>
        </div>
        <div class="card-body">
            <form method="get" th:action="${formAction}">
                <div class="row g-3 align-items-end">
                    <!-- 搜索框 -->
                    <div class="col-md-4" th:if="${filters.search}">
                        <label class="form-label fw-bold">
                            <i class="fas fa-search text-muted me-1"></i>搜索关键词
                        </label>
                        <div class="input-group">
                            <span class="input-group-text bg-light">
                                <i class="fas fa-search text-muted"></i>
                            </span>
                            <input type="text" 
                                   class="form-control" 
                                   th:placeholder="${filters.search.placeholder}"
                                   th:value="${filters.search.value}" 
                                   th:name="${filters.search.name}">
                            <button class="btn btn-outline-primary" type="submit">搜索</button>
                        </div>
                    </div>

                    <!-- 下拉筛选 -->
                    <div th:each="filter : ${filters.selects}" th:class="'col-md-' + (${filters.selects.size() <= 3} ? (12 / ${filters.selects.size()}) : 2)">
                        <label class="form-label fw-bold">
                            <i th:class="${filter.icon} + ' text-muted me-1'" th:if="${filter.icon}"></i>
                            <span th:text="${filter.label}">筛选项</span>
                        </label>
                        <select class="form-select" th:name="${filter.name}" onchange="this.form.submit()">
                            <option value="" th:text="'全部' + ${filter.label}">全部</option>
                            <option th:each="option : ${filter.options}" 
                                    th:value="${option.value}" 
                                    th:text="${option.text}"
                                    th:selected="${option.value == filter.selectedValue}">选项</option>
                        </select>
                    </div>

                    <!-- 操作按钮 -->
                    <div class="col-md-3">
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="button" class="btn btn-outline-secondary" onclick="resetFilters()">
                                <i class="fas fa-undo me-1"></i>重置
                            </button>
                            <button type="button" class="btn btn-success" onclick="exportData()">
                                <i class="fas fa-file-excel me-1"></i>导出
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- 数据表格组件 -->
    <div th:fragment="data-table(tableConfig, data)" class="card shadow-sm">
        <div class="card-header bg-white border-bottom">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <h5 class="mb-0 text-dark">
                        <i th:class="${tableConfig.icon} + ' text-primary me-2'" th:if="${tableConfig.icon}"></i>
                        <span th:text="${tableConfig.title}">数据列表</span>
                    </h5>
                    <span class="badge bg-light text-dark ms-3">
                        共 <span th:text="${data != null ? data.totalElements : 0}" class="fw-bold text-primary">0</span> 条记录
                    </span>
                </div>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover table-striped mb-0">
                    <thead class="table-light">
                        <tr>
                            <!-- 动态表头 -->
                            <th th:each="column : ${tableConfig.columns}" 
                                th:class="${column.class}"
                                th:style="${column.width != null ? 'width: ' + column.width : ''}">
                                <i th:class="${column.icon} + ' text-muted me-1'" th:if="${column.icon}"></i>
                                <span th:text="${column.title}">列标题</span>
                            </th>
                            <th class="text-center" style="width: 200px;">
                                <i class="fas fa-cogs text-muted me-1"></i>操作
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 数据行 -->
                        <tr th:each="row : ${data.content}" th:if="${data != null and !data.empty}" class="align-middle">
                            <!-- 动态数据列 -->
                            <td th:each="column : ${tableConfig.columns}" th:class="${column.class}">
                                <!-- 根据列类型渲染不同内容 -->
                                <span th:switch="${column.type}">
                                    <span th:case="'text'" th:text="${row[column.field]}">文本</span>
                                    <span th:case="'badge'" 
                                          th:class="'badge ' + ${column.badgeClass != null ? column.badgeClass.apply(row) : 'bg-secondary'}"
                                          th:text="${column.badgeText != null ? column.badgeText.apply(row) : row[column.field]}">状态</span>
                                    <span th:case="'date'" th:text="${row[column.field] != null ? #temporals.format(row[column.field], 'yyyy-MM-dd') : '-'}">日期</span>
                                    <span th:case="'datetime'" th:text="${row[column.field] != null ? #temporals.format(row[column.field], 'MM-dd HH:mm') : '-'}">日期时间</span>
                                    <span th:case="'avatar'">
                                        <img th:src="${row[column.field] ?: '/images/default-avatar.svg'}" 
                                             class="rounded-circle" width="40" height="40" alt="头像">
                                    </span>
                                    <span th:case="*" th:text="${row[column.field] ?: '-'}">默认</span>
                                </span>
                            </td>
                            
                            <!-- 操作按钮 -->
                            <td class="text-center">
                                <div class="btn-group btn-group-sm" role="group">
                                    <button th:each="action : ${tableConfig.actions}" 
                                            type="button" 
                                            th:class="'btn btn-outline-' + ${action.type}"
                                            th:title="${action.title}"
                                            th:onclick="${action.onclick != null ? action.onclick.apply(row) : action.function + '(' + row.id + ')'}"
                                            data-bs-toggle="tooltip" data-bs-placement="top">
                                        <i th:class="${action.icon}"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>

                        <!-- 无数据提示 -->
                        <tr th:if="${data == null or data.empty}">
                            <td th:colspan="${tableConfig.columns.size() + 1}" class="text-center py-5">
                                <div class="d-flex flex-column align-items-center text-muted">
                                    <i class="fas fa-inbox fa-3x mb-3 opacity-50"></i>
                                    <h5 class="mb-2">暂无数据</h5>
                                    <p class="mb-0">还没有相关数据</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- 分页组件 -->
            <div th:replace="~{components/admin/admin-components :: pagination(${data})}"></div>
        </div>
    </div>

    <!-- 分页组件 -->
    <div th:fragment="pagination(page)" class="d-flex justify-content-between align-items-center mt-4 px-3 pb-3" th:if="${page != null and page.totalPages > 1}">
        <div class="d-flex align-items-center">
            <span class="text-muted me-3">
                显示第 <span class="fw-bold text-primary" th:text="${page.number * page.size + 1}">1</span>
                到 <span class="fw-bold text-primary" th:text="${page.number * page.size + page.numberOfElements}">20</span>
                条，共 <span class="fw-bold text-primary" th:text="${page.totalElements}">100</span> 条记录
            </span>
            <div class="dropdown">
                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    每页 <span th:text="${page.size}">20</span> 条
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" th:href="@{''(page=0, size=10)}">每页 10 条</a></li>
                    <li><a class="dropdown-item" th:href="@{''(page=0, size=20)}">每页 20 条</a></li>
                    <li><a class="dropdown-item" th:href="@{''(page=0, size=50)}">每页 50 条</a></li>
                    <li><a class="dropdown-item" th:href="@{''(page=0, size=100)}">每页 100 条</a></li>
                </ul>
            </div>
        </div>

        <nav aria-label="分页导航">
            <ul class="pagination pagination-sm mb-0">
                <!-- 首页 -->
                <li class="page-item" th:classappend="${page.first} ? 'disabled' : ''">
                    <a class="page-link" th:href="${page.first} ? '#' : @{''(page=0, size=${page.size})}" title="首页">
                        <i class="fas fa-angle-double-left"></i>
                    </a>
                </li>

                <!-- 上一页 -->
                <li class="page-item" th:classappend="${page.first} ? 'disabled' : ''">
                    <a class="page-link"
                       th:href="${page.first} ? '#' : @{''(page=${page.number - 1}, size=${page.size})}"
                       title="上一页">
                        <i class="fas fa-angle-left"></i>
                    </a>
                </li>

                <!-- 页码 -->
                <th:block th:each="pageNum : ${#numbers.sequence(0, page.totalPages - 1)}">
                    <li class="page-item" th:classappend="${pageNum == page.number} ? 'active' : ''"
                        th:if="${pageNum >= page.number - 2 and pageNum <= page.number + 2}">
                        <a class="page-link"
                           th:href="@{''(page=${pageNum}, size=${page.size})}"
                           th:text="${pageNum + 1}">1</a>
                    </li>
                </th:block>

                <!-- 下一页 -->
                <li class="page-item" th:classappend="${page.last} ? 'disabled' : ''">
                    <a class="page-link"
                       th:href="${page.last} ? '#' : @{''(page=${page.number + 1}, size=${page.size})}"
                       title="下一页">
                        <i class="fas fa-angle-right"></i>
                    </a>
                </li>

                <!-- 末页 -->
                <li class="page-item" th:classappend="${page.last} ? 'disabled' : ''">
                    <a class="page-link" th:href="${page.last} ? '#' : @{''(page=${page.totalPages - 1}, size=${page.size})}" title="末页">
                        <i class="fas fa-angle-double-right"></i>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Admin样式 -->
    <style th:fragment="admin-style">
        .stat-card {
            border: none;
            border-radius: 10px;
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .stat-card.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stat-card.success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .stat-card.info {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
        }

        .table th {
            border-top: none;
            font-weight: 600;
            color: #495057;
        }

        .btn-group-sm .btn {
            padding: 0.25rem 0.5rem;
        }

        .pagination .page-link {
            color: #667eea;
            border-color: #dee2e6;
        }

        .pagination .page-item.active .page-link {
            background-color: #667eea;
            border-color: #667eea;
        }

        .pagination .page-link:hover {
            color: #5a6fd8;
            background-color: #e9ecef;
            border-color: #dee2e6;
        }
    </style>

    <!-- Admin JavaScript -->
    <script th:fragment="admin-script">
        // 重置筛选
        function resetFilters() {
            const form = document.querySelector('form[method="get"]');
            if (form) {
                const inputs = form.querySelectorAll('input, select');
                inputs.forEach(input => {
                    if (input.type === 'text' || input.type === 'search') {
                        input.value = '';
                    } else if (input.tagName === 'SELECT') {
                        input.selectedIndex = 0;
                    }
                });
                form.submit();
            }
        }

        // 导出数据
        function exportData() {
            const form = document.querySelector('form[method="get"]');
            if (form) {
                const formData = new FormData(form);
                const params = new URLSearchParams(formData);
                const exportUrl = window.location.pathname + '/export?' + params.toString();
                
                const link = document.createElement('a');
                link.href = exportUrl;
                link.download = '数据导出_' + new Date().toISOString().slice(0, 10) + '.xlsx';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // 初始化工具提示
        document.addEventListener('DOMContentLoaded', function() {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
</body>
</html>
