<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle ?: '智慧校园管理系统'}">智慧校园管理系统</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- 自定义CSS -->
    <link th:href="@{/css/admin.css}" rel="stylesheet">
    
    <!-- 引入组件样式 -->
    <th:block th:replace="~{components/sidebar :: sidebar-style}"></th:block>
    <th:block th:replace="~{components/topbar :: topbar-style}"></th:block>
    <th:block th:replace="~{components/admin/admin-components :: admin-style}"></th:block>

    <th:block th:fragment="head-extra">
        <!-- 页面特定的head内容 -->
    </th:block>
</head>
<body>
    <!-- 布局容器 -->
    <div class="wrapper">
        <!-- 左侧导航栏 -->
        <th:block th:replace="~{components/sidebar :: sidebar}"></th:block>

        <!-- 主内容区域 -->
        <div class="content" id="content">
            <!-- 顶部导航栏 -->
            <th:block th:replace="~{components/topbar :: topbar}"></th:block>

            <!-- 页面内容包装器 -->
            <div class="content-wrapper">
                <!-- 页面标题和操作按钮 -->
                <div class="d-sm-flex align-items-center justify-content-between mb-4" th:fragment="page-header">
                    <h1 class="h3 mb-0 text-gray-800" th:text="${pageTitle}">页面标题</h1>
                    <div th:fragment="page-actions">
                        <!-- 页面操作按钮 -->
                    </div>
                </div>

                <!-- 页面具体内容 -->
                <div th:fragment="content">
                    <!-- 页面具体内容 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 退出登录确认模态框 -->
    <th:block th:replace="~{components/topbar :: logout-modal}"></th:block>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

    <!-- 引入侧边栏脚本 -->
    <th:block th:replace="~{components/sidebar :: sidebar-script}"></th:block>

    <script>
        // 全局AJAX错误处理
        $(document).ajaxError(function(event, xhr, settings, thrownError) {
            if (xhr.status === 401) {
                window.location.href = '/admin/login';
            } else if (xhr.status === 403) {
                window.location.href = '/admin/access-denied';
            }
        });

        // 全局提示函数
        window.showAlert = function(message, type = 'info') {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            $('.alert').remove();
            $('.content-wrapper').prepend(alertHtml);
            
            setTimeout(() => {
                $('.alert').fadeOut();
            }, 3000);
        };

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 设置当前页面标识
            const currentPath = window.location.pathname;
            const pathSegments = currentPath.split('/');
            const currentPage = pathSegments[pathSegments.length - 1] || 'dashboard';
            
            // 将当前页面信息传递给模板
            document.body.setAttribute('data-current-page', currentPage);
        });
    </script>

    <th:block th:fragment="scripts">
        <!-- 页面特定的JavaScript -->
    </th:block>
</body>
</html>
