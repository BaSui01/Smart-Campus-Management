# æ™ºæ…§æ ¡å›­ç®¡ç†å¹³å° - æ•°æ®åº“è„šæœ¬å®æ–½è®¡åˆ’

## ğŸ“‹ å®æ–½æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è§„åˆ’äº†æ•°æ®åº“è„šæœ¬çš„åˆ›å»ºå’Œæ‰§è¡Œè®¡åˆ’ï¼Œä¸ºæ™ºæ…§æ ¡å›­ç®¡ç†å¹³å°æä¾›å®Œæ•´çš„æ•°æ®åº“ç¯å¢ƒæ­å»ºæ–¹æ¡ˆã€‚

## ğŸ—‚ï¸ æ–‡ä»¶ç»“æ„è§„åˆ’

```
database/
â”œâ”€â”€ scripts/                    # SQLè„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ 01_create_database.sql  # æ•°æ®åº“åˆ›å»ºè„šæœ¬
â”‚   â”œâ”€â”€ 02_create_tables.sql    # è¡¨ç»“æ„åˆ›å»ºè„šæœ¬
â”‚   â”œâ”€â”€ 03_create_indexes.sql   # ç´¢å¼•åˆ›å»ºè„šæœ¬
â”‚   â”œâ”€â”€ 04_create_views.sql     # è§†å›¾åˆ›å»ºè„šæœ¬
â”‚   â”œâ”€â”€ 05_init_data.sql        # åˆå§‹åŒ–æ•°æ®è„šæœ¬
â”‚   â””â”€â”€ 06_test_data.sql        # æµ‹è¯•æ•°æ®è„šæœ¬
â”œâ”€â”€ deploy/                     # éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ docker-compose.yml      # Dockerå®¹å™¨é…ç½®
â”‚   â”œâ”€â”€ mysql.cnf               # MySQLé…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ backup.sh               # å¤‡ä»½è„šæœ¬
â”‚   â””â”€â”€ restore.sh              # æ¢å¤è„šæœ¬
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md               # ä½¿ç”¨è¯´æ˜
â”‚   â””â”€â”€ CHANGELOG.md            # å˜æ›´è®°å½•
â””â”€â”€ execute.sh                  # ä¸€é”®æ‰§è¡Œè„šæœ¬
```

## ğŸ“œ è„šæœ¬æ–‡ä»¶è¯¦ç»†å†…å®¹

### 1. 01_create_database.sql - æ•°æ®åº“åˆ›å»ºè„šæœ¬

```sql
-- =====================================================
-- æ™ºæ…§æ ¡å›­ç®¡ç†å¹³å° - æ•°æ®åº“åˆ›å»ºè„šæœ¬
-- ç‰ˆæœ¬: 1.0.0
-- åˆ›å»ºæ—¶é—´: 2025-06-03
-- æè¿°: åˆ›å»ºæ•°æ®åº“ã€ç”¨æˆ·å’ŒåŸºæœ¬é…ç½®
-- =====================================================

-- è®¾ç½®å­—ç¬¦é›†
SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- åˆ›å»ºæ•°æ®åº“
DROP DATABASE IF EXISTS campus_management;
CREATE DATABASE campus_management
DEFAULT CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

-- ä½¿ç”¨æ•°æ®åº“
USE campus_management;

-- è®¾ç½®æ—¶åŒº
SET time_zone = '+08:00';

-- åˆ›å»ºæ•°æ®åº“ç”¨æˆ·
DROP USER IF EXISTS 'campus_user'@'%';
CREATE USER 'campus_user'@'%' IDENTIFIED BY 'campus_password';

-- æˆæƒ
GRANT SELECT, INSERT, UPDATE, DELETE ON campus_management.* TO 'campus_user'@'%';
FLUSH PRIVILEGES;

-- æ˜¾ç¤ºåˆ›å»ºç»“æœ
SHOW DATABASES LIKE 'campus_management';
SELECT USER();
```

### 2. 02_create_tables.sql - è¡¨ç»“æ„åˆ›å»ºè„šæœ¬

```sql
-- =====================================================
-- æ™ºæ…§æ ¡å›­ç®¡ç†å¹³å° - è¡¨ç»“æ„åˆ›å»ºè„šæœ¬
-- ç‰ˆæœ¬: 1.0.0
-- åˆ›å»ºæ—¶é—´: 2025-06-03
-- æè¿°: åˆ›å»ºæ‰€æœ‰ä¸šåŠ¡è¡¨ç»“æ„
-- =====================================================

USE campus_management;
SET FOREIGN_KEY_CHECKS = 0;

-- ===========================================
-- ç”¨æˆ·ç®¡ç†æ¨¡å—
-- ===========================================

-- 1. ç”¨æˆ·åŸºç¡€è¡¨
CREATE TABLE tb_user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·å',
    password VARCHAR(255) NOT NULL COMMENT 'å¯†ç ï¼ˆåŠ å¯†ï¼‰',
    email VARCHAR(100) UNIQUE COMMENT 'é‚®ç®±',
    phone VARCHAR(20) COMMENT 'æ‰‹æœºå·',
    real_name VARCHAR(50) COMMENT 'çœŸå®å§“å',
    avatar_url VARCHAR(255) COMMENT 'å¤´åƒURL',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-æ­£å¸¸ï¼Œ0-ç¦ç”¨',
    last_login_time DATETIME COMMENT 'æœ€åç™»å½•æ—¶é—´',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
) COMMENT='ç”¨æˆ·åŸºç¡€è¡¨';

-- 2. è§’è‰²è¡¨
CREATE TABLE tb_role (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'è§’è‰²ID',
    role_code VARCHAR(50) NOT NULL UNIQUE COMMENT 'è§’è‰²ç¼–ç ',
    role_name VARCHAR(100) NOT NULL COMMENT 'è§’è‰²åç§°',
    description VARCHAR(255) COMMENT 'è§’è‰²æè¿°',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-æ­£å¸¸ï¼Œ0-ç¦ç”¨',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
) COMMENT='è§’è‰²è¡¨';

-- 3. ç”¨æˆ·è§’è‰²å…³è”è¡¨
CREATE TABLE tb_user_role (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    role_id BIGINT NOT NULL COMMENT 'è§’è‰²ID',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´'
) COMMENT='ç”¨æˆ·è§’è‰²å…³è”è¡¨';

-- ... ç»§ç»­åˆ›å»ºå…¶ä»–18å¼ è¡¨ ...
-- (ç”±äºå†…å®¹è¾ƒé•¿ï¼Œè¿™é‡Œçœç•¥å…·ä½“è¡¨ç»“æ„ï¼Œå®é™…è„šæœ¬å°†åŒ…å«å®Œæ•´çš„21å¼ è¡¨)

SET FOREIGN_KEY_CHECKS = 1;
```

### 3. 03_create_indexes.sql - ç´¢å¼•åˆ›å»ºè„šæœ¬

```sql
-- =====================================================
-- æ™ºæ…§æ ¡å›­ç®¡ç†å¹³å° - ç´¢å¼•åˆ›å»ºè„šæœ¬
-- ç‰ˆæœ¬: 1.0.0
-- åˆ›å»ºæ—¶é—´: 2025-06-03
-- æè¿°: åˆ›å»ºæ€§èƒ½ä¼˜åŒ–ç´¢å¼•
-- =====================================================

USE campus_management;

-- ===========================================
-- ç”¨æˆ·ç®¡ç†æ¨¡å—ç´¢å¼•
-- ===========================================

-- ç”¨æˆ·è¡¨ç´¢å¼•
ALTER TABLE tb_user ADD INDEX idx_username (username);
ALTER TABLE tb_user ADD INDEX idx_email (email);
ALTER TABLE tb_user ADD INDEX idx_phone (phone);
ALTER TABLE tb_user ADD INDEX idx_status (status);

-- å­¦ç”Ÿè¡¨ç´¢å¼•
ALTER TABLE tb_student ADD INDEX idx_student_no (student_no);
ALTER TABLE tb_student ADD INDEX idx_class_id (class_id);
ALTER TABLE tb_student ADD INDEX idx_grade (grade);

-- ===========================================
-- å¤åˆç´¢å¼•ï¼ˆå¤šæ¡ä»¶æŸ¥è¯¢ä¼˜åŒ–ï¼‰
-- ===========================================

-- å­¦ç”Ÿæˆç»©æŸ¥è¯¢å¤åˆç´¢å¼•
ALTER TABLE tb_grade ADD INDEX idx_student_semester_course (student_id, semester, course_id);

-- æ¶ˆæ¯æŸ¥è¯¢å¤åˆç´¢å¼•
ALTER TABLE tb_message ADD INDEX idx_target_status_time (target_type, status, created_time);

-- è€ƒè¯•å®‰æ’æŸ¥è¯¢å¤åˆç´¢å¼•
ALTER TABLE tb_course_schedule ADD INDEX idx_semester_day_time (semester, day_of_week, start_time);

-- ç¼´è´¹è®°å½•æŸ¥è¯¢å¤åˆç´¢å¼•
ALTER TABLE tb_payment_record ADD INDEX idx_student_time_status (student_id, payment_time, status);
```

### 4. 04_create_views.sql - è§†å›¾åˆ›å»ºè„šæœ¬

```sql
-- =====================================================
-- æ™ºæ…§æ ¡å›­ç®¡ç†å¹³å° - è§†å›¾åˆ›å»ºè„šæœ¬
-- ç‰ˆæœ¬: 1.0.0
-- åˆ›å»ºæ—¶é—´: 2025-06-03
-- æè¿°: åˆ›å»ºä¸šåŠ¡æŸ¥è¯¢è§†å›¾
-- =====================================================

USE campus_management;

-- ===========================================
-- ä¸šåŠ¡æŸ¥è¯¢è§†å›¾
-- ===========================================

-- 1. å­¦ç”Ÿä¿¡æ¯æ¦‚è§ˆè§†å›¾
CREATE VIEW v_student_overview AS
SELECT
    s.id,
    s.student_no,
    u.real_name,
    u.email,
    u.phone,
    s.grade,
    c.class_name,
    c.class_no,
    tu.real_name as head_teacher_name,
    s.enrollment_date,
    s.status as student_status
FROM tb_student s
JOIN tb_user u ON s.user_id = u.id
LEFT JOIN tb_class c ON s.class_id = c.id
LEFT JOIN tb_teacher t ON c.head_teacher_id = t.id
LEFT JOIN tb_user tu ON t.user_id = tu.id;

-- 2. æ•™å¸ˆè¯¾ç¨‹å®‰æ’è§†å›¾
CREATE VIEW v_teacher_schedule AS
SELECT
    cs.id,
    t.teacher_no,
    tu.real_name as teacher_name,
    c.course_code,
    c.course_name,
    cs.semester,
    cs.day_of_week,
    cs.start_time,
    cs.end_time,
    cs.classroom,
    cl.class_name,
    cs.current_students,
    cs.max_students
FROM tb_course_schedule cs
JOIN tb_teacher t ON cs.teacher_id = t.id
JOIN tb_user tu ON t.user_id = tu.id
JOIN tb_course c ON cs.course_id = c.id
LEFT JOIN tb_class cl ON cs.class_id = cl.id
WHERE cs.status = 1;

-- 3. ç”¨æˆ·æ¶ˆæ¯æ¦‚è§ˆè§†å›¾
CREATE VIEW v_user_message_overview AS
SELECT
    u.id as user_id,
    u.username,
    u.real_name,
    COUNT(mr.id) as total_messages,
    COUNT(CASE WHEN mr.is_read = 0 THEN 1 END) as unread_count,
    COUNT(CASE WHEN mr.is_starred = 1 THEN 1 END) as starred_count,
    MAX(mr.created_time) as latest_message_time
FROM tb_user u
LEFT JOIN tb_message_read mr ON u.id = mr.user_id AND mr.is_deleted = 0
GROUP BY u.id, u.username, u.real_name;
```

### 5. 05_init_data.sql - åˆå§‹åŒ–æ•°æ®è„šæœ¬

```sql
-- =====================================================
-- æ™ºæ…§æ ¡å›­ç®¡ç†å¹³å° - åˆå§‹åŒ–æ•°æ®è„šæœ¬
-- ç‰ˆæœ¬: 1.0.0
-- åˆ›å»ºæ—¶é—´: 2025-06-03
-- æè¿°: æ’å…¥ç³»ç»Ÿè¿è¡Œå¿…éœ€çš„åŸºç¡€æ•°æ®
-- =====================================================

USE campus_management;

-- ===========================================
-- åŸºç¡€è§’è‰²æ•°æ®
-- ===========================================

INSERT INTO tb_role (role_code, role_name, description) VALUES
('ADMIN', 'ç³»ç»Ÿç®¡ç†å‘˜', 'ç³»ç»Ÿç®¡ç†å‘˜è§’è‰²ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™'),
('TEACHER', 'æ•™å¸ˆ', 'æ•™å¸ˆè§’è‰²ï¼Œè´Ÿè´£æ•™å­¦ç®¡ç†'),
('STUDENT', 'å­¦ç”Ÿ', 'å­¦ç”Ÿè§’è‰²ï¼Œè¿›è¡Œå­¦ä¹ æ´»åŠ¨'),
('PARENT', 'å®¶é•¿', 'å®¶é•¿è§’è‰²ï¼Œå…³æ³¨å­¦ç”ŸåŠ¨æ€');

-- ===========================================
-- ç³»ç»Ÿé…ç½®æ•°æ®
-- ===========================================

INSERT INTO tb_system_config (config_key, config_value, config_desc, config_type, is_system) VALUES
('system.name', 'æ™ºæ…§æ ¡å›­ç®¡ç†å¹³å°', 'ç³»ç»Ÿåç§°', 'STRING', 1),
('system.version', '1.0.0', 'ç³»ç»Ÿç‰ˆæœ¬', 'STRING', 1),
('system.logo', '/assets/logo.png', 'ç³»ç»ŸLogo', 'STRING', 1),
('course.max_selection', '10', 'å­¦ç”Ÿæœ€å¤§é€‰è¯¾æ•°é‡', 'INT', 1),
('exam.auto_grading', 'true', 'æ˜¯å¦å¯ç”¨è‡ªåŠ¨æ‰¹æ”¹', 'BOOLEAN', 1),
('email.enabled', 'true', 'é‚®ä»¶åŠŸèƒ½æ˜¯å¦å¯ç”¨', 'BOOLEAN', 1),
('email.sender', 'noreply@campus.edu', 'ç³»ç»Ÿé‚®ä»¶å‘é€åœ°å€', 'STRING', 1),
('notification.batch_size', '100', 'æ‰¹é‡é€šçŸ¥æ¯æ‰¹å¤„ç†æ•°é‡', 'INT', 1),
('file.upload.max_size', '10485760', 'æ–‡ä»¶ä¸Šä¼ æœ€å¤§å¤§å°ï¼ˆå­—èŠ‚ï¼‰', 'INT', 1),
('session.timeout', '7200', 'ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰', 'INT', 1);

-- ===========================================
-- æ¶ˆæ¯æ¨¡æ¿æ•°æ®
-- ===========================================

INSERT INTO tb_message_template (template_code, template_name, template_type, message_type, title_template, content_template, variables, send_channels) VALUES
('GRADE_PUBLISHED', 'æˆç»©å‘å¸ƒé€šçŸ¥', 'SYSTEM', 'NOTICE', '${courseName}æˆç»©å·²å‘å¸ƒ', 'æ‚¨å¥½ï¼Œ${studentName}åŒå­¦ï¼\n\næ‚¨çš„${courseName}è¯¾ç¨‹æˆç»©å·²å‘å¸ƒï¼š\næ€»æˆç»©ï¼š${finalScore}åˆ†\nç­‰çº§ï¼š${gradeLevel}\n\nè¯·åŠæ—¶ç™»å½•ç³»ç»ŸæŸ¥çœ‹è¯¦ç»†æˆç»©ä¿¡æ¯ã€‚', '["studentName","courseName","finalScore","gradeLevel"]', '["SYSTEM","EMAIL"]'),

('EXAM_REMINDER', 'è€ƒè¯•æé†’', 'SYSTEM', 'REMINDER', '${examName}è€ƒè¯•æé†’', 'æ‚¨å¥½ï¼Œ${studentName}åŒå­¦ï¼\n\næé†’æ‚¨ï¼š\nè€ƒè¯•åç§°ï¼š${examName}\nè€ƒè¯•æ—¶é—´ï¼š${examDate} ${startTime}-${endTime}\nè€ƒè¯•åœ°ç‚¹ï¼š${roomName}\nåº§ä½å·ï¼š${seatNumber}\n\nè¯·æå‰30åˆ†é’Ÿåˆ°è¾¾è€ƒåœºï¼Œæºå¸¦å¥½ç›¸å…³è¯ä»¶ã€‚', '["studentName","examName","examDate","startTime","endTime","roomName","seatNumber"]', '["SYSTEM","EMAIL"]'),

('PAYMENT_DUE', 'ç¼´è´¹æé†’', 'SYSTEM', 'REMINDER', '${itemName}ç¼´è´¹æé†’', 'æ‚¨å¥½ï¼Œ${studentName}çš„å®¶é•¿ï¼\n\n${itemName}ç¼´è´¹å³å°†åˆ°æœŸï¼š\nç¼´è´¹é‡‘é¢ï¼š${amount}å…ƒ\næˆªæ­¢æ—¥æœŸï¼š${dueDate}\n\nè¯·åŠæ—¶å®Œæˆç¼´è´¹ï¼Œé¿å…å½±å“å­¦ç”Ÿæ­£å¸¸å­¦ä¹ ã€‚', '["studentName","itemName","amount","dueDate"]', '["SYSTEM","EMAIL"]');

-- ===========================================
-- é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·
-- ===========================================

-- åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜ç”¨æˆ·ï¼ˆå¯†ç : admin123ï¼‰
INSERT INTO tb_user (username, password, email, real_name, status) VALUES
('admin', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBaLzQKW5QxJFy', 'admin@campus.edu', 'ç³»ç»Ÿç®¡ç†å‘˜', 1);

-- ç»‘å®šç®¡ç†å‘˜è§’è‰²
INSERT INTO tb_user_role (user_id, role_id) VALUES (1, 1);
```

### 6. 06_test_data.sql - æµ‹è¯•æ•°æ®è„šæœ¬

```sql
-- =====================================================
-- æ™ºæ…§æ ¡å›­ç®¡ç†å¹³å° - æµ‹è¯•æ•°æ®è„šæœ¬
-- ç‰ˆæœ¬: 1.0.0
-- åˆ›å»ºæ—¶é—´: 2025-06-03
-- æè¿°: æ’å…¥å¼€å‘è°ƒè¯•ç”¨çš„æµ‹è¯•æ•°æ®
-- =====================================================

USE campus_management;

-- ===========================================
-- æµ‹è¯•ç”¨æˆ·æ•°æ®
-- ===========================================

-- åˆ›å»ºæµ‹è¯•æ•™å¸ˆ
INSERT INTO tb_user (username, password, email, real_name, phone, status) VALUES
('teacher001', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBaLzQKW5QxJFy', 'teacher001@campus.edu', 'å¼ è€å¸ˆ', '13800001001', 1),
('teacher002', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBaLzQKW5QxJFy', 'teacher002@campus.edu', 'æè€å¸ˆ', '13800001002', 1);

-- ç»‘å®šæ•™å¸ˆè§’è‰²
INSERT INTO tb_user_role (user_id, role_id) VALUES (2, 2), (3, 2);

-- åˆ›å»ºæ•™å¸ˆä¿¡æ¯
INSERT INTO tb_teacher (user_id, teacher_no, department, title, hire_date, status) VALUES
(2, 'T001', 'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯', 'å‰¯æ•™æˆ', '2020-09-01', 1),
(3, 'T002', 'æ•°å­¦ä¸åº”ç”¨æ•°å­¦', 'è®²å¸ˆ', '2021-03-01', 1);

-- åˆ›å»ºæµ‹è¯•å­¦ç”Ÿ
INSERT INTO tb_user (username, password, email, real_name, phone, status) VALUES
('student001', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBaLzQKW5QxJFy', 'student001@campus.edu', 'ç‹å°æ˜', '13900001001', 1),
('student002', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBaLzQKW5QxJFy', 'student002@campus.edu', 'æå°çº¢', '13900001002', 1);

-- ç»‘å®šå­¦ç”Ÿè§’è‰²
INSERT INTO tb_user_role (user_id, role_id) VALUES (4, 3), (5, 3);

-- ===========================================
-- ç­çº§å’Œè¯¾ç¨‹æµ‹è¯•æ•°æ®
-- ===========================================

-- åˆ›å»ºæµ‹è¯•ç­çº§
INSERT INTO tb_class (class_name, class_no, grade, head_teacher_id, max_students, current_students, status) VALUES
('è®¡ç®—æœº2023-1ç­', 'CS2023-1', '2023çº§', 1, 30, 2, 1),
('è®¡ç®—æœº2023-2ç­', 'CS2023-2', '2023çº§', 2, 30, 0, 1);

-- åˆ›å»ºå­¦ç”Ÿä¿¡æ¯
INSERT INTO tb_student (user_id, student_no, grade, class_id, enrollment_date, status) VALUES
(4, '2023001001', '2023çº§', 1, '2023-09-01', 1),
(5, '2023001002', '2023çº§', 1, '2023-09-01', 1);

-- æ›´æ–°ç­çº§å­¦ç”Ÿæ•°é‡
UPDATE tb_class SET current_students = 2 WHERE id = 1;

-- åˆ›å»ºæµ‹è¯•è¯¾ç¨‹
INSERT INTO tb_course (course_code, course_name, credits, course_type, department, description, status) VALUES
('CS101', 'Javaç¨‹åºè®¾è®¡', 4.0, 'å¿…ä¿®', 'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯', 'Javaè¯­è¨€åŸºç¡€åŠé¢å‘å¯¹è±¡ç¼–ç¨‹', 1),
('MATH101', 'é«˜ç­‰æ•°å­¦', 5.0, 'å¿…ä¿®', 'æ•°å­¦ä¸åº”ç”¨æ•°å­¦', 'å¾®ç§¯åˆ†åŸºç¡€ç†è®ºä¸åº”ç”¨', 1);
```

## ğŸ³ Docker éƒ¨ç½²é…ç½®

### docker-compose.yml

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: campus_mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_DATABASE: campus_management
      MYSQL_USER: campus_user
      MYSQL_PASSWORD: campus_password
      TZ: Asia/Shanghai
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./mysql.cnf:/etc/mysql/conf.d/mysql.cnf
      - ./scripts:/docker-entrypoint-initdb.d
    command: --default-authentication-plugin=mysql_native_password
    networks:
      - campus_network

  redis:
    image: redis:7-alpine
    container_name: campus_redis
    restart: always
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - campus_network

volumes:
  mysql_data:
  redis_data:

networks:
  campus_network:
    driver: bridge
```

### mysql.cnf

```ini
[mysqld]
# åŸºæœ¬é…ç½®
default-storage-engine=INNODB
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci
init_connect='SET NAMES utf8mb4'

# æ€§èƒ½ä¼˜åŒ–
innodb_buffer_pool_size=256M
innodb_log_file_size=64M
innodb_file_per_table=1
innodb_flush_log_at_trx_commit=1

# æ—¶åŒºè®¾ç½®
default-time-zone='+08:00'

# è¿æ¥é…ç½®
max_connections=200
max_connect_errors=100

[mysql]
default-character-set=utf8mb4

[client]
default-character-set=utf8mb4
```

## ğŸš€ æ‰§è¡Œè„šæœ¬

### execute.sh - ä¸€é”®æ‰§è¡Œè„šæœ¬

```bash
#!/bin/bash

# =====================================================
# æ™ºæ…§æ ¡å›­ç®¡ç†å¹³å° - æ•°æ®åº“ä¸€é”®éƒ¨ç½²è„šæœ¬
# ç‰ˆæœ¬: 1.0.0
# æè¿°: è‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰æ•°æ®åº“è„šæœ¬
# =====================================================

# è®¾ç½®é¢œè‰²è¾“å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# æ•°æ®åº“è¿æ¥é…ç½®
DB_HOST="localhost"
DB_PORT="3306"
DB_USER="root"
DB_PASSWORD="root_password"

# è„šæœ¬ç›®å½•
SCRIPT_DIR="./scripts"

# è¾“å‡ºå‡½æ•°
print_info() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

print_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# æ£€æŸ¥MySQLè¿æ¥
check_mysql_connection() {
    print_info "æ£€æŸ¥MySQLè¿æ¥..."
    mysql -h $DB_HOST -P $DB_PORT -u $DB_USER -p$DB_PASSWORD -e "SELECT 1;" > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        print_info "MySQLè¿æ¥æˆåŠŸ"
        return 0
    else
        print_error "MySQLè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®"
        return 1
    fi
}

# æ‰§è¡ŒSQLè„šæœ¬
execute_sql_script() {
    local script_file=$1
    local script_name=$(basename $script_file)

    print_info "æ‰§è¡Œè„šæœ¬: $script_name"
    mysql -h $DB_HOST -P $DB_PORT -u $DB_USER -p$DB_PASSWORD < $script_file

    if [ $? -eq 0 ]; then
        print_info "è„šæœ¬ $script_name æ‰§è¡ŒæˆåŠŸ"
        return 0
    else
        print_error "è„šæœ¬ $script_name æ‰§è¡Œå¤±è´¥"
        return 1
    fi
}

# ä¸»æ‰§è¡Œæµç¨‹
main() {
    print_info "å¼€å§‹éƒ¨ç½²æ™ºæ…§æ ¡å›­ç®¡ç†å¹³å°æ•°æ®åº“..."

    # æ£€æŸ¥MySQLè¿æ¥
    check_mysql_connection
    if [ $? -ne 0 ]; then
        exit 1
    fi

    # æŒ‰é¡ºåºæ‰§è¡Œè„šæœ¬
    scripts=(
        "01_create_database.sql"
        "02_create_tables.sql"
        "03_create_indexes.sql"
        "04_create_views.sql"
        "05_init_data.sql"
        "06_test_data.sql"
    )

    for script in "${scripts[@]}"; do
        script_path="$SCRIPT_DIR/$script"
        if [ -f "$script_path" ]; then
            execute_sql_script "$script_path"
            if [ $? -ne 0 ]; then
                print_error "éƒ¨ç½²å¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯"
                exit 1
            fi
        else
            print_warning "è„šæœ¬æ–‡ä»¶ä¸å­˜åœ¨: $script_path"
        fi
    done

    print_info "æ•°æ®åº“éƒ¨ç½²å®Œæˆï¼"
    print_info "é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·: admin / admin123"
}

# æ‰§è¡Œä¸»å‡½æ•°
main
```

## ğŸ“š ä½¿ç”¨è¯´æ˜

### æœ¬åœ°éƒ¨ç½²

1. **å®‰è£…MySQL 8.x**
2. **æ‰§è¡Œè„šæœ¬**ï¼š
   ```bash
   chmod +x execute.sh
   ./execute.sh
   ```

### Dockeréƒ¨ç½²

1. **å¯åŠ¨å®¹å™¨**ï¼š
   ```bash
   docker-compose up -d
   ```

2. **æŸ¥çœ‹æ—¥å¿—**ï¼š
   ```bash
   docker-compose logs mysql
   ```

### éªŒè¯éƒ¨ç½²

```sql
-- è¿æ¥æ•°æ®åº“
mysql -u campus_user -p campus_management

-- éªŒè¯è¡¨ç»“æ„
SHOW TABLES;

-- éªŒè¯æ•°æ®
SELECT COUNT(*) FROM tb_user;
SELECT COUNT(*) FROM tb_role;
```

## ğŸ”„ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **åˆ‡æ¢æ¨¡å¼** - éœ€è¦åˆ‡æ¢åˆ°èƒ½å¤Ÿåˆ›å»ºSQLæ–‡ä»¶çš„æ¨¡å¼
2. **åˆ›å»ºè„šæœ¬** - æŒ‰ç…§ä¸Šè¿°è§„åˆ’åˆ›å»ºå…·ä½“çš„SQLè„šæœ¬æ–‡ä»¶
3. **æµ‹è¯•éªŒè¯** - åœ¨å¼€å‘ç¯å¢ƒä¸­æµ‹è¯•è„šæœ¬çš„æ­£ç¡®æ€§
4. **æ–‡æ¡£å®Œå–„** - è¡¥å……éƒ¨ç½²è¯´æ˜å’Œæ•…éšœæ’é™¤æŒ‡å—

## âœ… å‡†å¤‡å°±ç»ª

æ•°æ®åº“è„šæœ¬å®æ–½è®¡åˆ’å·²ç»è¯¦ç»†åˆ¶å®šï¼ŒåŒ…å«äº†ï¼š
- å®Œæ•´çš„SQLè„šæœ¬å†…å®¹è§„åˆ’
- Dockerå®¹å™¨åŒ–éƒ¨ç½²é…ç½®
- ä¸€é”®æ‰§è¡Œè„šæœ¬
- è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜

ç°åœ¨éœ€è¦åˆ‡æ¢åˆ°åˆé€‚çš„æ¨¡å¼æ¥åˆ›å»ºå…·ä½“çš„SQLè„šæœ¬æ–‡ä»¶ã€‚
