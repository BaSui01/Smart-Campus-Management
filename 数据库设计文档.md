# 智慧校园管理平台 - 数据库设计文档

## 📋 目录

1. [项目概述](#项目概述)
2. [数据库架构](#数据库架构)
3. [用户管理模块](#用户管理模块)
4. [教务管理模块](#教务管理模块)
5. [考试管理模块](#考试管理模块)
6. [财务管理模块](#财务管理模块)
7. [消息通知模块](#消息通知模块)
8. [系统管理模块](#系统管理模块)
9. [索引策略](#索引策略)
10. [视图设计](#视图设计)
11. [初始化数据](#初始化数据)
12. [数据库部署](#数据库部署)

## 项目概述

**项目名称：** 智慧校园管理平台
**数据库类型：** MySQL 8.x
**字符集：** utf8mb4
**排序规则：** utf8mb4_unicode_ci

**核心业务模块：**
- 用户管理：学生、教师、家长、管理员
- 教务管理：课程、班级、选课、成绩
- 考试管理：在线考试、题库、自动批改
- 财务管理：学费、缴费记录、统计
- 消息通知：站内信、邮件、公告
- 系统管理：权限、配置、日志

## 数据库架构

### 整体 ER 关系图

```mermaid
erDiagram
    %% 用户核心表
    USER ||--o{ STUDENT : "学生用户"
    USER ||--o{ TEACHER : "教师用户"
    USER ||--o{ PARENT : "家长用户"
    USER }|--|| ROLE : "用户角色"

    %% 学生和家长关系
    STUDENT ||--o{ STUDENT_PARENT : "学生家长关系"
    PARENT ||--o{ STUDENT_PARENT : "家长学生关系"

    %% 教务关系
    TEACHER ||--o{ COURSE : "教师课程"
    COURSE ||--o{ COURSE_SCHEDULE : "课程安排"
    CLASS ||--o{ STUDENT : "班级学生"
    STUDENT ||--o{ COURSE_SELECTION : "学生选课"
    STUDENT ||--o{ GRADE : "学生成绩"

    %% 考试关系
    COURSE ||--o{ EXAM : "课程考试"
    EXAM ||--o{ EXAM_STUDENT : "考试学生"
    QUESTION_BANK ||--o{ EXAM_QUESTION : "考试题目"
    EXAM_STUDENT ||--o{ EXAM_ANSWER : "学生答题"

    %% 财务关系
    STUDENT ||--o{ PAYMENT_RECORD : "缴费记录"
    FEE_ITEM ||--o{ PAYMENT_RECORD : "缴费项目"

    %% 消息关系
    USER ||--o{ MESSAGE : "用户消息"
    MESSAGE ||--o{ MESSAGE_READ : "消息阅读"
    USER ||--o{ ANNOUNCEMENT_TARGET : "公告目标"

    %% 系统管理
    USER ||--o{ OPERATION_LOG : "操作日志"
```

## 用户管理模块

### 1. 用户基础表 (tb_user)

```sql
CREATE TABLE tb_user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码（加密）',
    email VARCHAR(100) UNIQUE COMMENT '邮箱',
    phone VARCHAR(20) COMMENT '手机号',
    real_name VARCHAR(50) COMMENT '真实姓名',
    avatar_url VARCHAR(255) COMMENT '头像URL',
    status TINYINT DEFAULT 1 COMMENT '状态：1-正常，0-禁用',
    last_login_time DATETIME COMMENT '最后登录时间',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_phone (phone)
) COMMENT='用户基础表';
```

### 2. 角色表 (tb_role)

```sql
CREATE TABLE tb_role (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '角色ID',
    role_code VARCHAR(50) NOT NULL UNIQUE COMMENT '角色编码',
    role_name VARCHAR(100) NOT NULL COMMENT '角色名称',
    description VARCHAR(255) COMMENT '角色描述',
    status TINYINT DEFAULT 1 COMMENT '状态：1-正常，0-禁用',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) COMMENT='角色表';
```

### 3. 用户角色关联表 (tb_user_role)

```sql
CREATE TABLE tb_user_role (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    role_id BIGINT NOT NULL COMMENT '角色ID',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (user_id) REFERENCES tb_user(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES tb_role(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_role (user_id, role_id)
) COMMENT='用户角色关联表';
```

### 4. 学生表 (tb_student)

```sql
CREATE TABLE tb_student (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '学生ID',
    user_id BIGINT NOT NULL UNIQUE COMMENT '用户ID',
    student_no VARCHAR(50) NOT NULL UNIQUE COMMENT '学号',
    grade VARCHAR(20) COMMENT '年级',
    class_id BIGINT COMMENT '班级ID',
    enrollment_date DATE COMMENT '入学日期',
    graduation_date DATE COMMENT '毕业日期',
    status TINYINT DEFAULT 1 COMMENT '状态：1-在读，2-毕业，3-休学，0-退学',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (user_id) REFERENCES tb_user(id) ON DELETE CASCADE,
    INDEX idx_student_no (student_no),
    INDEX idx_class_id (class_id)
) COMMENT='学生表';
```

### 5. 教师表 (tb_teacher)

```sql
CREATE TABLE tb_teacher (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '教师ID',
    user_id BIGINT NOT NULL UNIQUE COMMENT '用户ID',
    teacher_no VARCHAR(50) NOT NULL UNIQUE COMMENT '教师工号',
    department VARCHAR(100) COMMENT '所属部门',
    title VARCHAR(50) COMMENT '职称',
    hire_date DATE COMMENT '入职日期',
    status TINYINT DEFAULT 1 COMMENT '状态：1-在职，0-离职',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (user_id) REFERENCES tb_user(id) ON DELETE CASCADE,
    INDEX idx_teacher_no (teacher_no)
) COMMENT='教师表';
```

### 6. 家长表 (tb_parent)

```sql
CREATE TABLE tb_parent (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '家长ID',
    user_id BIGINT NOT NULL UNIQUE COMMENT '用户ID',
    relationship VARCHAR(20) COMMENT '与学生关系',
    occupation VARCHAR(100) COMMENT '职业',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (user_id) REFERENCES tb_user(id) ON DELETE CASCADE
) COMMENT='家长表';
```

### 7. 学生家长关联表 (tb_student_parent)

```sql
CREATE TABLE tb_student_parent (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
    student_id BIGINT NOT NULL COMMENT '学生ID',
    parent_id BIGINT NOT NULL COMMENT '家长ID',
    relationship VARCHAR(20) COMMENT '关系',
    is_primary TINYINT DEFAULT 0 COMMENT '是否主要联系人：1-是，0-否',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    FOREIGN KEY (student_id) REFERENCES tb_student(id) ON DELETE CASCADE,
    FOREIGN KEY (parent_id) REFERENCES tb_parent(id) ON DELETE CASCADE,
    UNIQUE KEY uk_student_parent (student_id, parent_id)
) COMMENT='学生家长关联表';
```

## 教务管理模块

### 8. 班级表 (tb_class)

```sql
CREATE TABLE tb_class (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '班级ID',
    class_name VARCHAR(100) NOT NULL COMMENT '班级名称',
    class_no VARCHAR(50) NOT NULL UNIQUE COMMENT '班级编号',
    grade VARCHAR(20) COMMENT '年级',
    head_teacher_id BIGINT COMMENT '班主任ID',
    max_students INT DEFAULT 50 COMMENT '最大学生数',
    current_students INT DEFAULT 0 COMMENT '当前学生数',
    status TINYINT DEFAULT 1 COMMENT '状态：1-正常，0-停用',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (head_teacher_id) REFERENCES tb_teacher(id),
    INDEX idx_class_no (class_no),
    INDEX idx_grade (grade)
) COMMENT='班级表';
```

### 9. 课程表 (tb_course)

```sql
CREATE TABLE tb_course (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '课程ID',
    course_code VARCHAR(50) NOT NULL UNIQUE COMMENT '课程编码',
    course_name VARCHAR(100) NOT NULL COMMENT '课程名称',
    credits DECIMAL(3,1) COMMENT '学分',
    course_type VARCHAR(20) COMMENT '课程类型：必修/选修',
    department VARCHAR(100) COMMENT '开课部门',
    description TEXT COMMENT '课程描述',
    status TINYINT DEFAULT 1 COMMENT '状态：1-开课，0-停课',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_course_code (course_code),
    INDEX idx_course_type (course_type)
) COMMENT='课程表';
```

### 10. 课程安排表 (tb_course_schedule)

```sql
CREATE TABLE tb_course_schedule (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
    course_id BIGINT NOT NULL COMMENT '课程ID',
    teacher_id BIGINT NOT NULL COMMENT '教师ID',
    class_id BIGINT COMMENT '班级ID（可为空，表示选修课）',
    semester VARCHAR(20) NOT NULL COMMENT '学期',
    day_of_week TINYINT COMMENT '星期几：1-7',
    start_time TIME COMMENT '开始时间',
    end_time TIME COMMENT '结束时间',
    classroom VARCHAR(50) COMMENT '教室',
    max_students INT COMMENT '最大选课人数',
    current_students INT DEFAULT 0 COMMENT '当前选课人数',
    status TINYINT DEFAULT 1 COMMENT '状态：1-正常，0-取消',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (course_id) REFERENCES tb_course(id),
    FOREIGN KEY (teacher_id) REFERENCES tb_teacher(id),
    FOREIGN KEY (class_id) REFERENCES tb_class(id),
    INDEX idx_semester (semester),
    INDEX idx_day_time (day_of_week, start_time)
) COMMENT='课程安排表';
```

### 11. 选课记录表 (tb_course_selection)

```sql
CREATE TABLE tb_course_selection (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
    student_id BIGINT NOT NULL COMMENT '学生ID',
    schedule_id BIGINT NOT NULL COMMENT '课程安排ID',
    selection_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '选课时间',
    status TINYINT DEFAULT 1 COMMENT '状态：1-已选，2-已退课',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (student_id) REFERENCES tb_student(id) ON DELETE CASCADE,
    FOREIGN KEY (schedule_id) REFERENCES tb_course_schedule(id),
    UNIQUE KEY uk_student_schedule (student_id, schedule_id)
) COMMENT='选课记录表';
```

### 12. 成绩表 (tb_grade)

```sql
CREATE TABLE tb_grade (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '成绩ID',
    student_id BIGINT NOT NULL COMMENT '学生ID',
    course_id BIGINT NOT NULL COMMENT '课程ID',
    semester VARCHAR(20) NOT NULL COMMENT '学期',
    usual_score DECIMAL(5,2) COMMENT '平时成绩',
    exam_score DECIMAL(5,2) COMMENT '考试成绩',
    final_score DECIMAL(5,2) COMMENT '总成绩',
    grade_level VARCHAR(5) COMMENT '等级：A/B/C/D/F',
    is_pass TINYINT COMMENT '是否通过：1-通过，0-不通过',
    teacher_id BIGINT COMMENT '录入教师ID',
    remarks TEXT COMMENT '备注',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (student_id) REFERENCES tb_student(id) ON DELETE CASCADE,
    FOREIGN KEY (course_id) REFERENCES tb_course(id),
    FOREIGN KEY (teacher_id) REFERENCES tb_teacher(id),
    UNIQUE KEY uk_student_course_semester (student_id, course_id, semester),
    INDEX idx_semester (semester),
    INDEX idx_final_score (final_score)
) COMMENT='成绩表';
```

## 考试管理模块

### 13. 考试表 (tb_exam)

```sql
CREATE TABLE tb_exam (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '考试ID',
    exam_name VARCHAR(200) NOT NULL COMMENT '考试名称',
    exam_code VARCHAR(50) NOT NULL UNIQUE COMMENT '考试编码',
    course_id BIGINT NOT NULL COMMENT '课程ID',
    exam_type VARCHAR(20) NOT NULL COMMENT '考试类型：期中/期末/随堂/补考',
    semester VARCHAR(20) NOT NULL COMMENT '学期',
    exam_date DATE NOT NULL COMMENT '考试日期',
    start_time TIME NOT NULL COMMENT '开始时间',
    end_time TIME NOT NULL COMMENT '结束时间',
    duration INT NOT NULL COMMENT '考试时长（分钟）',
    total_score DECIMAL(5,2) DEFAULT 100.00 COMMENT '总分',
    pass_score DECIMAL(5,2) DEFAULT 60.00 COMMENT '及格分数',
    exam_mode VARCHAR(20) DEFAULT 'OFFLINE' COMMENT '考试模式：ONLINE-在线/OFFLINE-线下',
    exam_status VARCHAR(20) DEFAULT 'DRAFT' COMMENT '考试状态：DRAFT-草稿/PUBLISHED-已发布/ONGOING-进行中/FINISHED-已结束',
    teacher_id BIGINT COMMENT '出题教师ID',
    description TEXT COMMENT '考试说明',
    exam_rules TEXT COMMENT '考试规则',
    allow_late_submit TINYINT DEFAULT 0 COMMENT '是否允许迟交：1-是，0-否',
    late_submit_penalty DECIMAL(3,2) DEFAULT 0.00 COMMENT '迟交扣分比例',
    shuffle_questions TINYINT DEFAULT 0 COMMENT '是否打乱题目顺序：1-是，0-否',
    shuffle_options TINYINT DEFAULT 0 COMMENT '是否打乱选项顺序：1-是，0-否',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (course_id) REFERENCES tb_course(id),
    FOREIGN KEY (teacher_id) REFERENCES tb_teacher(id),
    INDEX idx_exam_code (exam_code),
    INDEX idx_course_id (course_id),
    INDEX idx_exam_date (exam_date),
    INDEX idx_semester (semester),
    INDEX idx_exam_status (exam_status)
) COMMENT='考试表';
```

### 14. 题库表 (tb_question_bank)

```sql
CREATE TABLE tb_question_bank (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '题目ID',
    question_code VARCHAR(50) UNIQUE COMMENT '题目编码',
    course_id BIGINT NOT NULL COMMENT '课程ID',
    chapter VARCHAR(100) COMMENT '所属章节',
    question_type VARCHAR(20) NOT NULL COMMENT '题目类型：SINGLE-单选/MULTIPLE-多选/JUDGE-判断/FILL-填空/ESSAY-问答',
    difficulty_level VARCHAR(10) NOT NULL COMMENT '难度等级：EASY-简单/MEDIUM-中等/HARD-困难',
    question_content TEXT NOT NULL COMMENT '题目内容',
    option_a VARCHAR(500) COMMENT '选项A',
    option_b VARCHAR(500) COMMENT '选项B',
    option_c VARCHAR(500) COMMENT '选项C',
    option_d VARCHAR(500) COMMENT '选项D',
    correct_answer TEXT NOT NULL COMMENT '正确答案',
    answer_analysis TEXT COMMENT '答案解析',
    score DECIMAL(4,2) DEFAULT 1.00 COMMENT '题目分值',
    usage_count INT DEFAULT 0 COMMENT '使用次数',
    creator_id BIGINT COMMENT '创建者ID',
    status TINYINT DEFAULT 1 COMMENT '状态：1-启用，0-禁用',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (course_id) REFERENCES tb_course(id),
    FOREIGN KEY (creator_id) REFERENCES tb_teacher(id),
    INDEX idx_question_code (question_code),
    INDEX idx_course_id (course_id),
    INDEX idx_question_type (question_type),
    INDEX idx_difficulty_level (difficulty_level),
    INDEX idx_chapter (chapter)
) COMMENT='题库表';
```

## 财务管理模块

### 15. 缴费项目表 (tb_fee_item)

```sql
CREATE TABLE tb_fee_item (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '缴费项目ID',
    item_name VARCHAR(100) NOT NULL COMMENT '项目名称',
    item_code VARCHAR(50) NOT NULL UNIQUE COMMENT '项目编码',
    amount DECIMAL(10,2) NOT NULL COMMENT '金额',
    fee_type VARCHAR(20) COMMENT '费用类型：学费/杂费/书费等',
    applicable_grade VARCHAR(50) COMMENT '适用年级',
    due_date DATE COMMENT '缴费截止日期',
    description TEXT COMMENT '项目描述',
    status TINYINT DEFAULT 1 COMMENT '状态：1-启用，0-停用',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_item_code (item_code),
    INDEX idx_fee_type (fee_type)
) COMMENT='缴费项目表';
```

### 16. 缴费记录表 (tb_payment_record)

```sql
CREATE TABLE tb_payment_record (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '缴费记录ID',
    student_id BIGINT NOT NULL COMMENT '学生ID',
    fee_item_id BIGINT NOT NULL COMMENT '缴费项目ID',
    amount DECIMAL(10,2) NOT NULL COMMENT '缴费金额',
    payment_method VARCHAR(20) COMMENT '缴费方式：现金/银行卡/支付宝/微信',
    payment_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '缴费时间',
    transaction_no VARCHAR(100) COMMENT '交易流水号',
    operator_id BIGINT COMMENT '操作员ID',
    remarks TEXT COMMENT '备注',
    status TINYINT DEFAULT 1 COMMENT '状态：1-成功，2-退款，0-失败',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (student_id) REFERENCES tb_student(id),
    FOREIGN KEY (fee_item_id) REFERENCES tb_fee_item(id),
    INDEX idx_student_id (student_id),
    INDEX idx_payment_time (payment_time),
    INDEX idx_transaction_no (transaction_no)
) COMMENT='缴费记录表';
```

## 消息通知模块

### 17. 消息模板表 (tb_message_template)

```sql
CREATE TABLE tb_message_template (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '模板ID',
    template_code VARCHAR(50) NOT NULL UNIQUE COMMENT '模板编码',
    template_name VARCHAR(100) NOT NULL COMMENT '模板名称',
    template_type VARCHAR(20) NOT NULL COMMENT '模板类型：SYSTEM-系统/CUSTOM-自定义',
    message_type VARCHAR(20) NOT NULL COMMENT '消息类型：NOTICE-通知/REMINDER-提醒/WARNING-警告/ANNOUNCEMENT-公告',
    title_template VARCHAR(200) NOT NULL COMMENT '标题模板',
    content_template TEXT NOT NULL COMMENT '内容模板',
    variables JSON COMMENT '模板变量定义（JSON格式）',
    send_channels JSON COMMENT '发送渠道：["SYSTEM","EMAIL","SMS"]',
    is_enabled TINYINT DEFAULT 1 COMMENT '是否启用：1-是，0-否',
    creator_id BIGINT COMMENT '创建者ID',
    description TEXT COMMENT '模板描述',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (creator_id) REFERENCES tb_user(id),
    INDEX idx_template_code (template_code),
    INDEX idx_template_type (template_type),
    INDEX idx_message_type (message_type)
) COMMENT='消息模板表';
```

### 18. 消息表 (tb_message)

```sql
CREATE TABLE tb_message (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '消息ID',
    message_code VARCHAR(50) UNIQUE COMMENT '消息编码',
    template_id BIGINT COMMENT '模板ID',
    sender_id BIGINT COMMENT '发送者ID',
    sender_type VARCHAR(20) DEFAULT 'USER' COMMENT '发送者类型：USER-用户/SYSTEM-系统',
    title VARCHAR(200) NOT NULL COMMENT '消息标题',
    content TEXT NOT NULL COMMENT '消息内容',
    message_type VARCHAR(20) NOT NULL COMMENT '消息类型：NOTICE-通知/REMINDER-提醒/WARNING-警告/ANNOUNCEMENT-公告',
    priority_level VARCHAR(10) DEFAULT 'NORMAL' COMMENT '优先级：LOW-低/NORMAL-普通/HIGH-高/URGENT-紧急',
    send_method VARCHAR(20) DEFAULT 'SYSTEM' COMMENT '发送方式：SYSTEM-站内信/EMAIL-邮件/SMS-短信/ALL-全部',
    target_type VARCHAR(20) NOT NULL COMMENT '目标类型：USER-指定用户/ROLE-角色/CLASS-班级/GRADE-年级/ALL-全部',
    target_users TEXT COMMENT '目标用户ID列表（JSON格式）',
    scheduled_time DATETIME COMMENT '定时发送时间',
    sent_time DATETIME COMMENT '实际发送时间',
    expire_time DATETIME COMMENT '过期时间',
    status VARCHAR(20) DEFAULT 'DRAFT' COMMENT '状态：DRAFT-草稿/SCHEDULED-定时/SENDING-发送中/SENT-已发送/FAILED-失败/CANCELLED-已取消',
    total_recipients INT DEFAULT 0 COMMENT '总接收人数',
    sent_count INT DEFAULT 0 COMMENT '已发送数量',
    read_count INT DEFAULT 0 COMMENT '已阅读数量',
    is_top TINYINT DEFAULT 0 COMMENT '是否置顶：1-是，0-否',
    allow_reply TINYINT DEFAULT 0 COMMENT '是否允许回复：1-是，0-否',
    business_type VARCHAR(50) COMMENT '业务类型：COURSE-课程/EXAM-考试/PAYMENT-缴费/GRADE-成绩等',
    business_id BIGINT COMMENT '关联业务ID',
    extra_data JSON COMMENT '扩展数据',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (template_id) REFERENCES tb_message_template(id),
    FOREIGN KEY (sender_id) REFERENCES tb_user(id),
    INDEX idx_message_code (message_code),
    INDEX idx_sender_id (sender_id),
    INDEX idx_message_type (message_type),
    INDEX idx_status (status),
    INDEX idx_scheduled_time (scheduled_time),
    INDEX idx_business_type_id (business_type, business_id),
    INDEX idx_created_time (created_time)
) COMMENT='消息表';
```

### 19. 消息阅读状态表 (tb_message_read)

```sql
CREATE TABLE tb_message_read (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ID',
    message_id BIGINT NOT NULL COMMENT '消息ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    is_read TINYINT DEFAULT 0 COMMENT '是否已读：1-是，0-否',
    read_time DATETIME COMMENT '阅读时间',
    is_starred TINYINT DEFAULT 0 COMMENT '是否收藏：1-是，0-否',
    is_deleted TINYINT DEFAULT 0 COMMENT '是否删除：1-是，0-否',
    delete_time DATETIME COMMENT '删除时间',
    reply_content TEXT COMMENT '回复内容',
    reply_time DATETIME COMMENT '回复时间',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    FOREIGN KEY (message_id) REFERENCES tb_message(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES tb_user(id) ON DELETE CASCADE,
    UNIQUE KEY uk_message_user (message_id, user_id),
    INDEX idx_user_id (user_id),
    INDEX idx_is_read (is_read),
    INDEX idx_is_starred (is_starred),
    INDEX idx_is_deleted (is_deleted)
) COMMENT='消息阅读状态表';
```

## 系统管理模块

### 20. 系统配置表 (tb_system_config)

```sql
CREATE TABLE tb_system_config (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '配置ID',
    config_key VARCHAR(100) NOT NULL UNIQUE COMMENT '配置键',
    config_value TEXT COMMENT '配置值',
    config_desc VARCHAR(255) COMMENT '配置描述',
    config_type VARCHAR(20) DEFAULT 'STRING' COMMENT '配置类型：STRING/INT/BOOLEAN/JSON',
    is_system TINYINT DEFAULT 0 COMMENT '是否系统配置：1-是，0-否',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_config_key (config_key)
) COMMENT='系统配置表';
```

### 21. 操作日志表 (tb_operation_log)

```sql
CREATE TABLE tb_operation_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '日志ID',
    user_id BIGINT COMMENT '操作用户ID',
    username VARCHAR(50) COMMENT '用户名',
    operation VARCHAR(100) COMMENT '操作内容',
    method VARCHAR(200) COMMENT '请求方法',
    params TEXT COMMENT '请求参数',
    ip_address VARCHAR(50) COMMENT 'IP地址',
    user_agent VARCHAR(500) COMMENT '用户代理',
    execution_time BIGINT COMMENT '执行时间（毫秒）',
    status TINYINT COMMENT '操作状态：1-成功，0-失败',
    error_msg TEXT COMMENT '错误信息',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    INDEX idx_user_id (user_id),
    INDEX idx_created_time (created_time),
    INDEX idx_operation (operation)
) COMMENT='操作日志表';
```

## 索引策略

### 主要索引设计原则

1. **主键索引：** 所有表都有自增主键 `id`
2. **唯一索引：** 用户名、邮箱、学号、工号等唯一字段
3. **外键索引：** 所有外键字段都建立索引
4. **查询索引：** 根据常用查询条件建立单列或复合索引
5. **时间索引：** 创建时间、更新时间等时间字段

### 复合索引示例

```sql
-- 学生成绩查询复合索引
ALTER TABLE tb_grade ADD INDEX idx_student_semester_course (student_id, semester, course_id);

-- 消息查询复合索引
ALTER TABLE tb_message ADD INDEX idx_target_status_time (target_type, status, created_time);

-- 考试安排查询复合索引
ALTER TABLE tb_course_schedule ADD INDEX idx_semester_day_time (semester, day_of_week, start_time);

-- 缴费记录查询复合索引
ALTER TABLE tb_payment_record ADD INDEX idx_student_time_status (student_id, payment_time, status);
```

## 视图设计

### 1. 学生信息概览视图

```sql
CREATE VIEW v_student_overview AS
SELECT
    s.id,
    s.student_no,
    u.real_name,
    u.email,
    u.phone,
    s.grade,
    c.class_name,
    c.class_no,
    tu.real_name as head_teacher_name,
    s.enrollment_date,
    s.status as student_status
FROM tb_student s
JOIN tb_user u ON s.user_id = u.id
LEFT JOIN tb_class c ON s.class_id = c.id
LEFT JOIN tb_teacher t ON c.head_teacher_id = t.id
LEFT JOIN tb_user tu ON t.user_id = tu.id;
```

### 2. 教师课程安排视图

```sql
CREATE VIEW v_teacher_schedule AS
SELECT
    cs.id,
    t.teacher_no,
    tu.real_name as teacher_name,
    c.course_code,
    c.course_name,
    cs.semester,
    cs.day_of_week,
    cs.start_time,
    cs.end_time,
    cs.classroom,
    cl.class_name,
    cs.current_students,
    cs.max_students
FROM tb_course_schedule cs
JOIN tb_teacher t ON cs.teacher_id = t.id
JOIN tb_user tu ON t.user_id = tu.id
JOIN tb_course c ON cs.course_id = c.id
LEFT JOIN tb_class cl ON cs.class_id = cl.id
WHERE cs.status = 1;
```

## 初始化数据

### 1. 基础角色数据

```sql
INSERT INTO tb_role (role_code, role_name, description) VALUES
('ADMIN', '系统管理员', '系统管理员角色，拥有所有权限'),
('TEACHER', '教师', '教师角色，负责教学管理'),
('STUDENT', '学生', '学生角色，进行学习活动'),
('PARENT', '家长', '家长角色，关注学生动态');
```

### 2. 系统配置数据

```sql
INSERT INTO tb_system_config (config_key, config_value, config_desc, config_type, is_system) VALUES
('system.name', '智慧校园管理平台', '系统名称', 'STRING', 1),
('system.version', '1.0.0', '系统版本', 'STRING', 1),
('course.max_selection', '10', '学生最大选课数量', 'INT', 1),
('email.enabled', 'true', '邮件功能是否启用', 'BOOLEAN', 1),
('session.timeout', '7200', '会话超时时间（秒）', 'INT', 1);
```

### 3. 消息模板数据

```sql
INSERT INTO tb_message_template (template_code, template_name, template_type, message_type, title_template, content_template, variables, send_channels) VALUES
('GRADE_PUBLISHED', '成绩发布通知', 'SYSTEM', 'NOTICE', '${courseName}成绩已发布', '您好，${studentName}同学！您的${courseName}课程成绩已发布，总成绩：${finalScore}分，等级：${gradeLevel}。请及时登录系统查看详细信息。', '["studentName","courseName","finalScore","gradeLevel"]', '["SYSTEM","EMAIL"]'),
('EXAM_REMINDER', '考试提醒', 'SYSTEM', 'REMINDER', '${examName}考试提醒', '您好，${studentName}同学！提醒您：考试名称：${examName}，考试时间：${examDate} ${startTime}-${endTime}，考试地点：${roomName}。请提前30分钟到达考场。', '["studentName","examName","examDate","startTime","endTime","roomName"]', '["SYSTEM","EMAIL"]'),
('PAYMENT_DUE', '缴费提醒', 'SYSTEM', 'REMINDER', '${itemName}缴费提醒', '您好，${studentName}的家长！${itemName}缴费即将到期，缴费金额：${amount}元，截止日期：${dueDate}。请及时完成缴费。', '["studentName","itemName","amount","dueDate"]', '["SYSTEM","EMAIL"]');
```

## 数据库部署

### 1. 数据库创建脚本

```sql
-- 创建数据库
CREATE DATABASE campus_management
DEFAULT CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

-- 使用数据库
USE campus_management;

-- 设置时区
SET time_zone = '+08:00';
```

### 2. 数据库连接配置

**Spring Boot 配置示例：**
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/campus_management?useUnicode=true&characterEncoding=utf8mb4&useSSL=false&serverTimezone=Asia/Shanghai
    username: campus_user
    password: campus_password
    driver-class-name: com.mysql.cj.jdbc.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
```

### 3. 数据库用户权限

```sql
-- 创建数据库用户
CREATE USER 'campus_user'@'%' IDENTIFIED BY 'campus_password';

-- 授权
GRANT SELECT, INSERT, UPDATE, DELETE ON campus_management.* TO 'campus_user'@'%';
FLUSH PRIVILEGES;
```

## 总结

本数据库设计文档涵盖了智慧校园管理平台的完整数据架构，包括：

- **21个核心业务表** - 覆盖用户管理、教务管理、考试管理、财务管理、消息通知、系统管理等模块
- **完善的索引策略** - 保证查询性能和数据完整性
- **实用的视图设计** - 简化复杂查询和数据展示
- **标准化的初始数据** - 提供系统启动所需的基础数据
- **部署配置指南** - 确保数据库能够正确部署和运行

该设计支持平台的核心业务需求，具有良好的扩展性和维护性，为后续的应用开发提供了坚实的数据基础。
